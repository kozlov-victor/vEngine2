!function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=102)}([function(t,e,r){"use strict";r.r(e),r.d(e,"__extends",function(){return i}),r.d(e,"__assign",function(){return o}),r.d(e,"__rest",function(){return s}),r.d(e,"__decorate",function(){return a}),r.d(e,"__param",function(){return u}),r.d(e,"__metadata",function(){return h}),r.d(e,"__awaiter",function(){return c}),r.d(e,"__generator",function(){return l}),r.d(e,"__exportStar",function(){return f}),r.d(e,"__values",function(){return d}),r.d(e,"__read",function(){return p}),r.d(e,"__spread",function(){return g}),r.d(e,"__await",function(){return m}),r.d(e,"__asyncGenerator",function(){return _}),r.d(e,"__asyncDelegator",function(){return y}),r.d(e,"__asyncValues",function(){return v}),r.d(e,"__makeTemplateObject",function(){return E}),r.d(e,"__importStar",function(){return w}),r.d(e,"__importDefault",function(){return x});
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function i(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var o=function(){return(o=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function s(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(t);i<n.length;i++)e.indexOf(n[i])<0&&(r[n[i]]=t[n[i]])}return r}function a(t,e,r,n){var i,o=arguments.length,s=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,r,s):i(e,r))||s);return o>3&&s&&Object.defineProperty(e,r,s),s}function u(t,e){return function(r,n){e(r,n,t)}}function h(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function c(t,e,r,n){return new(r||(r=Promise))(function(i,o){function s(t){try{u(n.next(t))}catch(t){o(t)}}function a(t){try{u(n.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new r(function(e){e(t.value)}).then(s,a)}u((n=n.apply(t,e||[])).next())})}function l(t,e){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function f(t,e){for(var r in t)e.hasOwnProperty(r)||(e[r]=t[r])}function d(t){var e="function"==typeof Symbol&&t[Symbol.iterator],r=0;return e?e.call(t):{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}}}function p(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,i,o=r.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(n=o.next()).done;)s.push(n.value)}catch(t){i={error:t}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return s}function g(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(p(arguments[e]));return t}function m(t){return this instanceof m?(this.v=t,this):new m(t)}function _(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,i=r.apply(t,e||[]),o=[];return n={},s("next"),s("throw"),s("return"),n[Symbol.asyncIterator]=function(){return this},n;function s(t){i[t]&&(n[t]=function(e){return new Promise(function(r,n){o.push([t,e,r,n])>1||a(t,e)})})}function a(t,e){try{!function(t){t.value instanceof m?Promise.resolve(t.value.v).then(u,h):c(o[0][2],t)}(i[t](e))}catch(t){c(o[0][3],t)}}function u(t){a("next",t)}function h(t){a("throw",t)}function c(t,e){t(e),o.shift(),o.length&&a(o[0][0],o[0][1])}}function y(t){var e,r;return e={},n("next"),n("throw",function(t){throw t}),n("return"),e[Symbol.iterator]=function(){return this},e;function n(n,i){e[n]=t[n]?function(e){return(r=!r)?{value:m(t[n](e)),done:"return"===n}:i?i(e):e}:i}}function v(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,r=t[Symbol.asyncIterator];return r?r.call(t):(t=d(t),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(r){e[r]=t[r]&&function(e){return new Promise(function(n,i){(function(t,e,r,n){Promise.resolve(n).then(function(e){t({value:e,done:r})},e)})(n,i,(e=t[r](e)).done,e.value)})}}}function E(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function w(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function x(t){return t&&t.__esModule?t:{default:t}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(0),i=function(t){function e(e){var r=t.call(this,e)||this;return Error.captureStackTrace?Error.captureStackTrace(r,r.constructor):r.stack=(new Error).stack,r.name="DebugError",r.errorMessage=e,r}return n.__extends(e,t),e.prototype.toString=function(){return this.errorMessage},e}(Error);e.DebugError=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(0),i=r(14),o=r(4),s=r(8),a=function(t){function e(e,r,n,i,o){void 0===e&&(e=0),void 0===r&&(r=0),void 0===n&&(n=0),void 0===i&&(i=0);var s=t.call(this)||this;return o&&s.addListener(o),s.setXYWH(e,r,n,i),s}return n.__extends(e,t),e.prototype.checkObservableChanged=function(){return this._state.setState(this.x,this.y,this.width,this.height)},e.prototype.observe=function(t){this.addListener(t)},e.prototype.revalidate=function(){this.right=this.x+this.width,this.bottom=this.y+this.height,this.triggerObservable()},e.prototype.setXYWH=function(t,e,r,n){return this.x=t,this.y=e,this.width=r,this.height=n,this.revalidate(),this},e.prototype.setXY=function(t,e){return this.x=t,this.y=e,this.revalidate(),this},e.prototype.setWH=function(t,e){return this.width=t,this.height=e,this.revalidate(),this},e.prototype.set=function(t){return this.setXYWH(t.x,t.y,t.width,t.height),this},e.prototype.setSize=function(t){return this.width=t.width,this.height=t.height,this.revalidate(),this},e.prototype.setPoint=function(t){return t.setXY(t.x,t.y),this},e.prototype.addXY=function(t,e){return this.x+=t,this.y+=e,this.revalidate(),this},e.prototype.addPoint=function(t){return this.addXY(t.x,t.y),this},e.prototype.getPoint=function(){var t=this;return void 0===this.p&&(this.p=new o.Point2d(0,0)),this.p.setXY(this.x,this.y),this.p.addListener(function(){return t.setXY(t.p.x,t.p.y)}),this.p},e.prototype.getSize=function(){return void 0===this.size&&(this.size=new i.Size),this.size.setWH(this.width,this.height),this.size},e.prototype.asArray=function(){return[this.x,this.y,this.width,this.height]},e.prototype.clone=function(){return new e(this.x,this.y,this.width,this.height)},e.prototype.toJSON=function(){return{x:this.x,y:this.y,width:this.width,height:this.height}},e.prototype.fromJSON=function(t){this.setXYWH(t.x,t.y,t.width,t.height)},e.fromPool=function(){return e.rectPool.getNextObject()},e.rectPool=new s.ObjectPool(e),e}(r(28).ObservableEntity);e.Rect=a},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(8),i=function(){function t(t,e,r,n){this._arr=null,this.type="Color",this.setRGBA(t,e,r,n)}return t.prototype.normalizeToZeroOne=function(){this.rNorm=this.r/255,this.gNorm=this.g/255,this.bNorm=this.b/255,this.aNorm=this.a/255},t.prototype.setRGBA=function(t,e,r,n){void 0===n&&(n=255),this.r=t,this.g=e,this.b=r,this.a=n,this.normalizeToZeroOne()},t.prototype.setRGB=function(t,e,r){this.r=t,this.g=e,this.b=r,this.a=255,this.normalizeToZeroOne()},t.prototype.setR=function(t){this.r=t,this.normalizeToZeroOne()},t.prototype.setG=function(t){this.g=t,this.normalizeToZeroOne()},t.prototype.setB=function(t){this.b=t,this.normalizeToZeroOne()},t.prototype.setA=function(t){this.a=t,this.normalizeToZeroOne()},t.prototype.set=function(t){this.setRGBA(t.r,t.g,t.b,t.a)},t.prototype.clone=function(){return new t(this.r,this.g,this.b,this.a)},t.getFromPool=function(){return void 0===t.objectPool&&(t.objectPool=new n.ObjectPool(t)),t.objectPool.getNextObject()},t.RGB=function(e,r,n,i){var o=new t(0,0,0);return o.setRGBA(e,r,n,i),o},t.prototype.asGL=function(){return null===this._arr&&(this._arr=new Array(3)),this._arr[0]=this.rNorm,this._arr[1]=this.gNorm,this._arr[2]=this.bNorm,this._arr[3]=this.aNorm,this._arr},t.prototype.asCSS=function(){return"rgba("+this.r+","+this.g+","+this.b+","+this.a+")"},t.prototype.toJSON=function(){return{r:this.r,g:this.g,b:this.b,a:this.a}},t.prototype.fromJSON=function(t){this.setRGBA(t.r,t.g,t.b,t.a)},t.WHITE=t.RGB(255,255,255),t.GREY=t.RGB(127,127,127),t.BLACK=t.RGB(0,0,0),t.NONE=t.RGB(0,0,0,0),t}();e.Color=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(0),i=r(8),o=function(t){function e(e,r,n){void 0===e&&(e=0),void 0===r&&(r=0);var i=t.call(this)||this;return i._x=0,i._y=0,i._x=e,i._y=r,n&&i.addListener(n),i}return n.__extends(e,t),e.fromPool=function(){return e.pool.getNextObject()},Object.defineProperty(e.prototype,"x",{get:function(){return this._x},set:function(t){this.setX(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},set:function(t){this.setY(t)},enumerable:!0,configurable:!0}),e.prototype.checkObservableChanged=function(){return this._state.setState(this._x,this._y)},e.prototype.observe=function(t){this.addListener(t)},e.prototype.setXY=function(t,e){return void 0===e&&(e=t),this._x=t,this._y=e,this.triggerObservable(),this},e.prototype.setX=function(t){return this._x=t,this.triggerObservable(),this},e.prototype.setY=function(t){return this._y=t,this.triggerObservable(),this},e.prototype.set=function(t){return this.setXY(t._x,t._y),this.triggerObservable(),this},e.prototype.add=function(t){return this.addXY(t._x,t._y),this.triggerObservable(),this},e.prototype.substract=function(t){return this.addXY(-t._x,-t._y),this.triggerObservable(),this},e.prototype.multiply=function(t){return this._x*=t,this._y*=t,this.triggerObservable(),this},e.prototype.addXY=function(t,e){return this._x+=t,this._y+=e,this.triggerObservable(),this},e.prototype.addX=function(t){return this._x+=t,this.triggerObservable(),this},e.prototype.addY=function(t){return this._y+=t,this.triggerObservable(),this},e.prototype.negative=function(){return this._x=-this._x,this._y=-this._y,this.triggerObservable(),this},e.prototype.equal=function(t){return this._x===t&&this._y===t},e.prototype.equalXY=function(t,e){return this._x===t&&this._y===e},e.prototype.equalPoint=function(t){return this._x===t._x&&this._y===t._y},e.prototype.clone=function(){return new e(this._x,this._y)},e.prototype.fromJSON=function(t){this.setXY(t.x,t.y)},e.prototype.toJSON=function(){return{x:this._x,y:this._y}},e.prototype.toArray=function(){return this._arr||(this._arr=new Array(2)),this._arr[0]=this._x,this._arr[1]=this._y,this._arr},e.pool=new i.ObjectPool(e,4),e}(r(28).ObservableEntity);e.Point2d=o},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(1);e.compileShader=function(t,e,r){if(!e)throw new n.DebugError("can not compile shader: shader source not specified for type "+r);var i=t.createShader(r);if(!i)throw new n.DebugError("can not allocate memory for shader: gl.createShader(shaderType)");if(t.shaderSource(i,e),t.compileShader(i),!t.getShaderParameter(i,t.COMPILE_STATUS)){var o=t.getShaderInfoLog(i);t.deleteShader(i);var s=function(t){for(var e,r=[];e=t.match(/ERROR\:([^\n]+)/);){t=t.slice(e.index+1);var n=e[1].trim().split(":"),i=n.slice(2).join(":").trim(),o=parseInt(n[1],10);r.push({message:i,lineNum:o})}return r}(o),a=e.split("\n"),u="";throw s.forEach(function(t){var e=t.lineNum-1;-1==a[e].indexOf("-----\x3e")&&(a[e]="-----\x3e "+a[e]),u+=a[e]+" <----"+t.message+"\n"}),console.log(a.join("\n")),new n.DebugError("Error compiling shader: "+(u||o))}return i},e.createProgram=function(t,e,r){var i=t.createProgram();if(!i)throw new n.DebugError("can not allocate memory for gl.createProgram()");if(t.attachShader(i,e),t.attachShader(i,r),t.linkProgram(i),!t.getProgramParameter(i,t.LINK_STATUS)){t.deleteProgram(i);var o=t.getProgramInfoLog(i),s=t.getProgramParameter(i,t.VALIDATE_STATUS);throw console.error("VALIDATE_STATUS",s),new n.DebugError("Error in program linking "+o)}return i};var i=null;e.GL_TYPE={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D"};var o=function(t,r){if(!i){var n=Object.keys(e.GL_TYPE);i={};for(var o=0;o<n.length;++o){var s=n[o];i[t[s]]=e.GL_TYPE[s]}}return i[r]};e.normalizeUniformName=function(t){return t.indexOf("[")>-1?t.split("[")[0]:t},e.extractUniforms=function(t,r){for(var i=r.getProgram(),s=t.getProgramParameter(i,t.ACTIVE_UNIFORMS),a={},u=0;u<s;u++){var h=t.getActiveUniform(i,u);if(!h)throw new n.DebugError("can not receive active uniforms info: gl.getActiveUniform()");var c=o(t,h.type),f=e.normalizeUniformName(h.name),d=t.getUniformLocation(i,f);a[f]={type:c,size:h.size,location:d,setter:l(h.size,c)}}return a},e.extractAttributes=function(t,e){for(var r=e.getProgram(),i=t.getProgramParameter(r,t.ACTIVE_ATTRIBUTES),o={},s=0;s<i;s++){var a=t.getActiveAttrib(r,s);if(!a)throw new n.DebugError("can not receive active attribute info: gl.getActiveAttrib()");var u=t.getAttribLocation(r,a.name);if(u<0)throw console.log(e),new n.DebugError("error finding attribute location: "+a.name);o[a.name]=u}return o};var s={check:function(t){if(isNaN(parseFloat(t))||!isFinite(t))throw new n.DebugError("can not set uniform with value "+t+": expected argument of type number")}},a={check:function(t){if(s.check(t),t!==~~t)throw new n.DebugError("can not set uniform with value "+t+": expected argument of integer type, but "+t+" found")}},u={check:function(t){if(1!=t&&0!=t)throw new n.DebugError("can not set uniform with value "+t+": expected argument of boolean type, but "+t+" found")}},h=function(t,e){return{check:function(r){if(!r)throw new n.DebugError("can not set uniform  value: "+r);if(!r.splice)throw console.error("Can not set uniform value",r),new n.DebugError("can not set uniform with value ["+r+"]: expected argument of type Array");if(void 0!==e&&r.length!==e)throw new n.DebugError("can not set uniform with value ["+r+"]: expected array with size "+e+", but "+r.length+" found");for(var i=0;i<r.length;i++)try{t.check(r[i])}catch(t){throw console.error("Can not set uniform array item",r),new n.DebugError("can not set uniform array item with value ["+r+"]: unexpected array element type: "+r[i])}}}},c=function(t,e){e.check(t)},l=function(t,r){if(1===t)switch(r){case e.GL_TYPE.FLOAT:return function(t,e,r){c(r,s),t.uniform1f(e,r)};case e.GL_TYPE.FLOAT_VEC2:return function(t,e,r){c(r,h(s,2)),t.uniform2f(e,r[0],r[1])};case e.GL_TYPE.FLOAT_VEC3:return function(t,e,r){c(r,h(s,3)),t.uniform3f(e,r[0],r[1],r[2])};case e.GL_TYPE.FLOAT_VEC4:return function(t,e,r){c(r,h(s,4)),t.uniform4f(e,r[0],r[1],r[2],r[3])};case e.GL_TYPE.INT:return function(t,e,r){c(r,a),t.uniform1i(e,r)};case e.GL_TYPE.INT_VEC2:return function(t,e,r){c(r,h(a,2)),t.uniform2i(e,r[0],r[1])};case e.GL_TYPE.INT_VEC3:return function(t,e,r){c(r,h(a,3)),t.uniform3i(e,r[0],r[1],r[2])};case e.GL_TYPE.INT_VEC4:return function(t,e,r){c(r,h(a,4)),t.uniform4i(e,r[0],r[1],r[2],r[3])};case e.GL_TYPE.BOOL:return function(t,e,r){c(r,u),t.uniform1i(e,r)};case e.GL_TYPE.BOOL_VEC2:return function(t,e,r){c(r,h(u,2)),t.uniform2i(e,r[0],r[1])};case e.GL_TYPE.BOOL_VEC3:return function(t,e,r){c(r,h(u,3)),t.uniform3i(e,r[0],r[1],r[2])};case e.GL_TYPE.BOOL_VEC4:return function(t,e,r){c(r,h(u,4)),t.uniform4i(e,r[0],r[1],r[2],r[3])};case e.GL_TYPE.FLOAT_MAT2:return function(t,e,r){c(r,h(s,4)),t.uniformMatrix2fv(e,!1,r)};case e.GL_TYPE.FLOAT_MAT3:return function(t,e,r){c(r,h(s,9)),t.uniformMatrix3fv(e,!1,r)};case e.GL_TYPE.FLOAT_MAT4:return function(t,e,r){c(r,h(s,16)),t.uniformMatrix4fv(e,!1,r)};case e.GL_TYPE.SAMPLER_2D:return function(t,e,r){c(r,a),t.uniform1i(e,r)};default:throw new n.DebugError("can not set uniform for type "+r+" and size "+t)}else switch(r){case e.GL_TYPE.FLOAT:return function(e,r,n){c(n,h(s,t)),e.uniform1fv(r,n)};case e.GL_TYPE.FLOAT_VEC2:return function(e,r,n){c(n,h(s,2*t)),e.uniform2fv(r,n)};case e.GL_TYPE.FLOAT_VEC3:return function(e,r,n){c(n,h(s,3*t)),e.uniform3fv(r,n)};case e.GL_TYPE.FLOAT_VEC4:return function(e,r,n){c(n,h(s,4*t)),e.uniform4fv(r,n)};case e.GL_TYPE.INT:return function(t,e,r){c(r,a),t.uniform1iv(e,r)};case e.GL_TYPE.INT_VEC2:return function(e,r,n){c(n,h(a,2*t)),e.uniform2iv(r,n)};case e.GL_TYPE.INT_VEC3:return function(e,r,n){c(n,h(a,3*t)),e.uniform3iv(r,n)};case e.GL_TYPE.INT_VEC4:return function(e,r,n){c(n,h(a,4*t)),e.uniform4iv(r,n)};case e.GL_TYPE.BOOL:return function(t,e,r){c(r,u),t.uniform1iv(e,r)};case e.GL_TYPE.BOOL_VEC2:return function(e,r,n){c(n,h(u,2*t)),e.uniform2iv(r,n)};case e.GL_TYPE.BOOL_VEC3:return function(e,r,n){c(n,h(u,3*t)),e.uniform3iv(r,n)};case e.GL_TYPE.BOOL_VEC4:return function(e,r,n){c(n,h(u,4*t)),e.uniform4iv(r,n)};case e.GL_TYPE.SAMPLER_2D:return function(t,e,r){c(r,a),t.uniform1iv(e,r)};default:throw new n.DebugError("can not set uniform for type "+r+" and size "+t)}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,i,o,s=r(0),a=r(2),u=r(22),h=r(25),c=r(1);!function(t){t[t.HIDDEN=0]="HIDDEN",t[t.VISIBLE=1]="VISIBLE"}(n=e.OVERFLOW||(e.OVERFLOW={})),function(t){t.FIXED="FIXED",t.WRAP_CONTENT="WRAP_CONTENT",t.MATCH_PARENT="MATCH_PARENT"}(i=e.LAYOUT_SIZE||(e.LAYOUT_SIZE={})),function(t){t.NORMAL="NORMAL",t.ACTIVE="ACTIVE",t.DISABLED="DISABLED"}(o=e.STATE||(e.STATE={}));var l=function(t){function e(e){var r=t.call(this,e)||this;return r.marginLeft=0,r.marginTop=0,r.marginRight=0,r.marginBottom=0,r.paddingLeft=0,r.paddingTop=0,r.paddingRight=0,r.paddingBottom=0,r.layoutWidth=i.WRAP_CONTENT,r.layoutHeight=i.WRAP_CONTENT,r.overflow=n.HIDDEN,r.background=void 0,r.drawingRect=new a.Rect,r.maxWidth=0,r.maxHeight=0,r.bgByState={},r.state=o.NORMAL,r._screenRect=new a.Rect,r.on(u.MOUSE_EVENTS.mouseDown,function(){r.state=o.ACTIVE}),r.on(u.MOUSE_EVENTS.mouseUp,function(){r.state=o.NORMAL}),r.on(u.MOUSE_EVENTS.mouseLeave,function(){r.state=o.NORMAL}),r}return s.__extends(e,t),e.prototype.testLayout=function(){if(this.layoutWidth===i.FIXED&&0===this.width)throw new c.DebugError("layoutWidth is LAYOUT_SIZE.FIXED so width must be specified");if(this.layoutHeight===i.FIXED&&0===this.height)throw new c.DebugError("layoutHeight is LAYOUT_SIZE.FIXED so height must be specified")},e.normalizeBorders=function(t,e,r,n){return void 0===e&&void 0===r&&void 0===n?e=r=n=t:void 0===r&&void 0===n?(r=t,n=e):void 0===n&&(n=e),{top:t,right:e,bottom:r,left:n}},e.prototype.setMargins=function(t,r,n,i){var o;t=(o=e.normalizeBorders(t,r,n,i)).top,r=o.right,n=o.bottom,i=o.left,this.marginTop=t,this.marginRight=r,this.marginBottom=n,this.marginLeft=i,this._setDirty()},e.prototype.setMarginsTopBottom=function(t,e){void 0===e&&(e=t),this.paddingTop=t,this.paddingBottom=e,this._setDirty()},e.prototype.setMarginsLeftRight=function(t,e){void 0===e&&(e=t),this.marginLeft=t,this.marginRight=e,this._setDirty()},e.prototype.setPaddings=function(t,r,n,i){var o;t=(o=e.normalizeBorders(t,r,n,i)).top,r=o.right,n=o.bottom,i=o.left,this.paddingTop=t,this.paddingRight=r,this.paddingBottom=n,this.paddingLeft=i,this._setDirty()},e.prototype.setPaddingsTopBottom=function(t,e){void 0===e&&(e=t),this.paddingTop=t,this.paddingBottom=e,this._setDirty()},e.prototype.setPaddingsLeftRight=function(t,e){void 0===e&&(e=t),this.paddingLeft=t,this.paddingRight=e,this._setDirty()},e.prototype.describeStates=function(t){var e=this,n=r(33);Object.keys(t).forEach(function(r){var i=o[r],s=new(0,n[t[r].type])(e.game);s.fromJSON(t[r]),e.bgByState[i]=s})},e.prototype.revalidate=function(){this.calcLayoutRect(),t.prototype.revalidate.call(this)},e.prototype.onGeometryChanged=function(){this.revalidate()},e.prototype.getRect=function(){return this._dirty&&this.calcLayoutRect(),this._rect},e.prototype.getScreenRect=function(){return this._screenRect},e.prototype.calcLayoutRect=function(){this._rect.setXYWH(this.pos.x,this.pos.y,this.width+this.marginLeft+this.marginRight,this.height+this.marginTop+this.marginBottom),this._screenRect.set(this._rect);for(var t=this.parent;t;)this._screenRect.addXY(t.getRect().x,t.getRect().y),t=t.parent},e.prototype.getBgByState=function(){var t=this.bgByState[this.state];return t||(t=this.background),t},e.prototype.setWH=function(t,e){this.width=t,this.height=e,this.drawingRect.setWH(t,e)},e.prototype.calcDrawableRect=function(t,e){var r=t+this.paddingLeft+this.paddingRight,n=e+this.paddingTop+this.paddingBottom;this.background?(this.background.setWH(r,n),this.width=this.background.width,this.height=this.background.height):(this.width=r,this.height=n),this.calcLayoutRect()},e.prototype.update=function(e,r){this.background=this.getBgByState(),this._dirty&&(this.onGeometryChanged(),this._dirty=!1),t.prototype.update.call(this,e,r)},e.prototype.beforeRender=function(){this.game.getRenderer().translate(this.pos.x+this.marginLeft,this.pos.y+this.marginTop)},e}(h.RenderableModel);e.Container=l},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(1),i=r(5),o=function(){function t(t,e,r){var n=i.compileShader(t,e,t.VERTEX_SHADER),o=i.compileShader(t,r,t.FRAGMENT_SHADER);this.program=i.createProgram(t,n,o),t.deleteShader(n),t.deleteShader(o),this.uniforms=i.extractUniforms(t,this),this.attributes=i.extractAttributes(t,this),this.gl=t}return t.prototype.getProgram=function(){return this.program},t.prototype.bind=function(){this.gl.useProgram(this.program),t.currentProgram=this},t.prototype.setUniform=function(e,r){if(!e)throw new n.DebugError("no uniform name was provided!");var i=this.uniforms[e];if(i){if(t.currentProgram!==this)throw console.error(this),new n.DebugError("can not set uniform: target program is inactive");i.setter(this.gl,i.location,r)}},t.prototype.bindBuffer=function(t,e){if(!e)throw new n.DebugError("can not found attribute location: attrLocationName not defined");if(void 0===this.attributes[e])throw console.log(this),new n.DebugError("can not found attribute location for  "+e);this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t.getGlBuffer());var r=this.attributes[e];this.gl.enableVertexAttribArray(r),this.gl.vertexAttribPointer(r,t.getItemSize(),t.getItemType(),!1,0,0)},t.prototype.destroy=function(){this.gl.deleteProgram(this.program)},t.currentProgram=null,t}();e.ShaderProgram=o},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(1),i=function(){function t(t,e,r){if(void 0===e&&(e=16),void 0===r&&(r=!0),this.Class=t,this._pool=[],this._cnt=0,this._numberOfInstances=e,!t)throw new n.DebugError("can not instantiate ObjectPool: class not provided in constructor");if(!r)for(var i=0;i<e;i++)this._pool.push(new t)}return t.prototype.getNextObject=function(){var t=this._cnt++%this._numberOfInstances;return void 0===this._pool[t]&&(this._pool[t]=new this.Class),this._pool[t]},t}();e.ObjectPool=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(1);e.makeIdentity=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},e.makeZToWMatrix=function(t){return[1,0,0,0,0,1,0,0,0,0,1,t,0,0,0,1]},e.make2DProjection=function(t,e,r){return[2/t,0,0,0,0,-2/e,0,0,0,0,2/r,0,-1,1,0,1]},e.ortho=function(t,e,r,n,i,o){var s=1/(t-e),a=1/(r-n),u=1/(i-o),h=new Array(16);return h[0]=-2*s,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=-2*a,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=2*u,h[11]=0,h[12]=(t+e)*s,h[13]=(n+r)*a,h[14]=(o+i)*u,h[15]=1,h},e.perspective=function(t,e,r,n){var i=1/Math.tan(t/2),o=1/(r-n),s=new Array(16);return s[0]=i/e,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=i,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=(n+r)*o,s[11]=-1,s[12]=0,s[13]=0,s[14]=2*n*r*o,s[15]=0,s},e.makeTranslation=function(t,e,r){return[1,0,0,0,0,1,0,0,0,0,1,0,t,e,r,1]},e.makeXRotation=function(t){var e=Math.cos(t),r=Math.sin(t);return[1,0,0,0,0,e,r,0,0,-r,e,0,0,0,0,1]},e.makeYRotation=function(t){var e=Math.cos(t),r=Math.sin(t);return[e,0,-r,0,0,1,0,0,r,0,e,0,0,0,0,1]},e.makeZRotation=function(t){var e=Math.cos(t),r=Math.sin(t);return[e,r,0,0,-r,e,0,0,0,0,1,0,0,0,0,1]},e.makeScale=function(t,e,r){return[t,0,0,0,0,e,0,0,0,0,r,0,0,0,0,1]},e.matrixMultiply=function(t,e){var r=new Array(16);return r[0]=t[0]*e[0]+t[1]*e[4]+t[2]*e[8]+t[3]*e[12],r[1]=t[0]*e[1]+t[1]*e[5]+t[2]*e[9]+t[3]*e[13],r[2]=t[0]*e[2]+t[1]*e[6]+t[2]*e[10]+t[3]*e[14],r[3]=t[0]*e[3]+t[1]*e[7]+t[2]*e[11]+t[3]*e[15],r[4]=t[4]*e[0]+t[5]*e[4]+t[6]*e[8]+t[7]*e[12],r[5]=t[4]*e[1]+t[5]*e[5]+t[6]*e[9]+t[7]*e[13],r[6]=t[4]*e[2]+t[5]*e[6]+t[6]*e[10]+t[7]*e[14],r[7]=t[4]*e[3]+t[5]*e[7]+t[6]*e[11]+t[7]*e[15],r[8]=t[8]*e[0]+t[9]*e[4]+t[10]*e[8]+t[11]*e[12],r[9]=t[8]*e[1]+t[9]*e[5]+t[10]*e[9]+t[11]*e[13],r[10]=t[8]*e[2]+t[9]*e[6]+t[10]*e[10]+t[11]*e[14],r[11]=t[8]*e[3]+t[9]*e[7]+t[10]*e[11]+t[11]*e[15],r[12]=t[12]*e[0]+t[13]*e[4]+t[14]*e[8]+t[15]*e[12],r[13]=t[12]*e[1]+t[13]*e[5]+t[14]*e[9]+t[15]*e[13],r[14]=t[12]*e[2]+t[13]*e[6]+t[14]*e[10]+t[15]*e[14],r[15]=t[12]*e[3]+t[13]*e[7]+t[14]*e[11]+t[15]*e[15],r},e.multMatrixVec=function(t,e){for(var r=new Array(16),n=0;n<4;n++)r[n]=e[0]*t[0+n]+e[1]*t[4+n]+e[2]*t[8+n]+e[3]*t[12+n];return r},e.inverse=function(t){var e=new Array(16);e[0]=t[5]*t[10]*t[15]-t[5]*t[14]*t[11]-t[6]*t[9]*t[15]+t[6]*t[13]*t[11]+t[7]*t[9]*t[14]-t[7]*t[13]*t[10],e[1]=-t[1]*t[10]*t[15]+t[1]*t[14]*t[11]+t[2]*t[9]*t[15]-t[2]*t[13]*t[11]-t[3]*t[9]*t[14]+t[3]*t[13]*t[10],e[2]=t[1]*t[6]*t[15]-t[1]*t[14]*t[7]-t[2]*t[5]*t[15]+t[2]*t[13]*t[7]+t[3]*t[5]*t[14]-t[3]*t[13]*t[6],e[3]=-t[1]*t[6]*t[11]+t[1]*t[10]*t[7]+t[2]*t[5]*t[11]-t[2]*t[9]*t[7]-t[3]*t[5]*t[10]+t[3]*t[9]*t[6],e[4]=-t[4]*t[10]*t[15]+t[4]*t[14]*t[11]+t[6]*t[8]*t[15]-t[6]*t[12]*t[11]-t[7]*t[8]*t[14]+t[7]*t[12]*t[10],e[5]=t[0]*t[10]*t[15]-t[0]*t[14]*t[11]-t[2]*t[8]*t[15]+t[2]*t[12]*t[11]+t[3]*t[8]*t[14]-t[3]*t[12]*t[10],e[6]=-t[0]*t[6]*t[15]+t[0]*t[14]*t[7]+t[2]*t[4]*t[15]-t[2]*t[12]*t[7]-t[3]*t[4]*t[14]+t[3]*t[12]*t[6],e[7]=t[0]*t[6]*t[11]-t[0]*t[10]*t[7]-t[2]*t[4]*t[11]+t[2]*t[8]*t[7]+t[3]*t[4]*t[10]-t[3]*t[8]*t[6],e[8]=t[4]*t[9]*t[15]-t[4]*t[13]*t[11]-t[5]*t[8]*t[15]+t[5]*t[12]*t[11]+t[7]*t[8]*t[13]-t[7]*t[12]*t[9],e[9]=-t[0]*t[9]*t[15]+t[0]*t[13]*t[11]+t[1]*t[8]*t[15]-t[1]*t[12]*t[11]-t[3]*t[8]*t[13]+t[3]*t[12]*t[9],e[10]=t[0]*t[5]*t[15]-t[0]*t[13]*t[7]-t[1]*t[4]*t[15]+t[1]*t[12]*t[7]+t[3]*t[4]*t[13]-t[3]*t[12]*t[5],e[11]=-t[0]*t[5]*t[11]+t[0]*t[9]*t[7]+t[1]*t[4]*t[11]-t[1]*t[8]*t[7]-t[3]*t[4]*t[9]+t[3]*t[8]*t[5],e[12]=-t[4]*t[9]*t[14]+t[4]*t[13]*t[10]+t[5]*t[8]*t[14]-t[5]*t[12]*t[10]-t[6]*t[8]*t[13]+t[6]*t[12]*t[9],e[13]=t[0]*t[9]*t[14]-t[0]*t[13]*t[10]-t[1]*t[8]*t[14]+t[1]*t[12]*t[10]+t[2]*t[8]*t[13]-t[2]*t[12]*t[9],e[14]=-t[0]*t[5]*t[14]+t[0]*t[13]*t[6]+t[1]*t[4]*t[14]-t[1]*t[12]*t[6]-t[2]*t[4]*t[13]+t[2]*t[12]*t[5],e[15]=t[0]*t[5]*t[10]-t[0]*t[9]*t[6]-t[1]*t[4]*t[10]+t[1]*t[8]*t[6]+t[2]*t[4]*t[9]-t[2]*t[8]*t[5];var r=t[0]*e[0]+t[1]*e[4]+t[2]*e[8]+t[3]*e[12];if(0===r)throw console.error(t),new n.DebugError("can not invert matrix");for(var i=0;i<16;i++)e[i]/=r;return e},e.IDENTITY=e.makeIdentity()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(9),i=r(4),o=function(){function t(){}return t.isPointInRect=function(t,e,r){return t.x>e.x&&t.x<e.x+e.width&&t.y>e.y&&t.y<e.y+e.height},t.overlapTest=function(t,e){return t.x<e.x+e.width&&t.x+t.width>e.x&&t.y<e.y+e.height&&t.y+t.height>e.y},t.radToDeg=function(t){return 180*t/Math.PI},t.degToRad=function(t){return t*Math.PI/180},t.rectToPolar=function(t,e){return{radius:Math.sqrt(t.x*t.x+e.y*e.y),angle:Math.atan2(e.y-t.y,e.x-t.x)}},t.polarToRect=function(t,e,r){var n=t*Math.cos(e),o=t*Math.sin(e);return new i.Point2d(r.x-n,r.y-o)},t.getDistanceSquared=function(t,e){return Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)},t.closeTo=function(t,e,r){return void 0===r&&(r=.01),Math.abs(t-e)<=r},t.getDistance=function(e,r){return Math.sqrt(t.getDistanceSquared(e,r))},t.getAngle=function(t,e){var r=t.x-e.x,n=t.y-e.y;return Math.atan2(n,r)},t.unProject=function(t,e,r,o){var s=2*t.x/e-1,a=2*t.y/r-1,u=n.inverse(o),h=[s,a,0,1],c=n.multMatrixVec(u,h);return c[0]=(c[0]/2+.5)*e,c[1]=(c[1]/2+.5)*r,new i.Point2d(c[0],c[1])},t.random=function(t,e){if(t>e){var r=t;t=e,e=r}var n=~~(Math.random()*(e-t))+t;return n>e?n=e:n<t&&(n=t),n},t}();e.MathEx=o},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(15),i=function(){function t(e){this.program=null,this.uniformCache={},this.gl=e,t.instances.push(this)}return t.prototype.bind=function(){null!==t.currentInstance&&t.currentInstance!==this&&t.currentInstance.unbind(),t.currentInstance=this,this.bufferInfo.bind(this.program)},t.prototype.unbind=function(){this.bufferInfo.unbind()},t.prototype.destroy=function(){this.bufferInfo&&this.bufferInfo.destroy(),this.program.destroy()},t.destroyAll=function(){t.instances.forEach(function(t){t.destroy()})},t.prototype.setUniform=function(t,e){if(!n.isEqual(this.uniformCache[t],e)){if(n.isArray(e)){this.uniformCache[t]||(this.uniformCache[t]=Array(e.length));for(var r=0,i=e.length;r<i;r++)this.uniformCache[t][r]=e[r]}else this.uniformCache[t]=e;this.program.setUniform(t,this.uniformCache[t])}},t.prototype.drawElements=function(){this.bufferInfo.draw()},t.prototype.draw=function(t,e,r){var n=this;void 0===r&&(r=null),this.bind(),Object.keys(e).forEach(function(t){return n.setUniform(t,e[t])}),t&&t.forEach(function(t,e){t.texture.bind(t.name,e,n.program)}),this.drawElements()},t.currentInstance=null,t.instances=[],t}();e.AbstractDrawer=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(0),i=function(t){function e(e){var r=t.call(this,e)||this;return r.borderRadius=0,r.width=16,r.height=16,r.lineWidth=1,r}return n.__extends(e,t),e.prototype.draw=function(){return this.game.getRenderer().drawRectangle(this),!0},e}(r(21).Shape);e.Rectangle=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(47),i=function(t,e){var r=e.split(".");if(1===r.length)return{targetObj:t,targetKey:e};var n=r.pop();return r.forEach(function(e){t=t[e]}),{targetObj:t,targetKey:n}},o=function(t,e,r){var n=i(t,e);n.targetObj[n.targetKey]=r},s=function(t,e){var r=i(t,e);return r.targetObj[r.targetKey]},a=function(){function t(t){this._propsToChange=[],this._startedTime=0,this._currTime=0,this._completed=!1,this._target=t.target,this._progressFn=t.progress,this._completeFn=t.complete,this._easeFnName=t.ease||"linear",this._tweenTime=t.time||1e3,this._desc=this.normalizeDesc(t)}return t.prototype.reuse=function(t){var e=this;this._startedTime=this._currTime,this._completed=!1,Object.keys(t).forEach(function(r){e._desc[r]=t[r]}),this._desc=this.normalizeDesc(t)},t.prototype.normalizeDesc=function(t){var e=this;t.from=t.from||{},t.to=t.to||{};var r={};return Object.keys(t.from).forEach(function(t){r[t]=!0}),Object.keys(t.to).forEach(function(t){r[t]=!0}),this._propsToChange=Object.keys(r),this._propsToChange.forEach(function(r){void 0===t.from[r]&&(t.from[r]=s(e._target,r)),void 0===t.to[r]&&(t.to[r]=s(e._target,r))}),t},t.prototype.update=function(t){if(!this._completed){this._currTime=t,this._startedTime||(this._startedTime=t);var e=t-this._startedTime;if(e>this._tweenTime)this.complete();else{for(var r=this._propsToChange.length;r--;){var i=this._propsToChange[r],s=this._desc.from[i],a=this._desc.to[i],u=(0,n.Easing[this._easeFnName])(e,s,a-s,this._tweenTime);o(this._target,i,u)}this._progressFn&&this._progressFn(this._target)}}},t.prototype.progress=function(t){this._progressFn=t},t.prototype.reset=function(){this._startedTime=null,this._completed=!1},t.prototype.complete=function(){if(!this._completed){for(var t=this._propsToChange.length;t--;){var e=this._propsToChange[t],r=this._desc.to[e];o(this._target,e,r)}this._progressFn&&this._progressFn(this._target),this._completeFn&&this._completeFn(this._target),this._completed=!0}},t.prototype.isCompleted=function(){return this._completed},t.prototype.getTarget=function(){return this._target},t.prototype.getTweenTime=function(){return this._tweenTime},t}();e.Tween=a},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(8),i=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.width=t,this.height=e}return t.prototype.setW=function(t){return this.width=t,this},t.prototype.setH=function(t){return this.height=t,this},t.prototype.setWH=function(t,e){return this.width=t,this.height=e,this},t.prototype.set=function(t){return this.width=t.width,this.height=t.height,this},t.fromPool=function(){return t.rectPool.getNextObject()},t.rectPool=new n.ObjectPool(t),t}();e.Size=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isObjectMatch=function(t,e){if(!t||!e)return!1;var r=!0,n=Object.keys(e);return!!n.length&&(n.some(function(n){if(t[n]!=e[n])return r=!1,!0}),r)},e.isObject=function(t){return t===Object(t)},e.isArray=function(t){return!!t.splice};e.isEqual=function(t,r){return void 0!==t&&(e.isArray(t)&&e.isArray(r)?function(t,e){for(var r=0,n=t.length;r<n;r++)if(t[r]!==e[r])return!1;return!0}(t,r):e.isObject(t)&&e.isObject(r)?function(t,e){throw"not implemented"}():t===r)}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(1),i=r(79),o=r(80),s=function(){function t(t,e){if(this.posVertexBuffer=null,this.posIndexBuffer=null,this.texVertexBuffer=null,this.normalBuffer=null,this.drawMethod=null,this.numOfElementsToDraw=0,this.gl=t,void 0===e.drawMethod)throw new n.DebugError("can not create BufferInfo: drawMethod not defined");if(this.drawMethod=e.drawMethod,!e.posVertexInfo)throw new n.DebugError("can not create BufferInfo: posVertexInfo is mandatory");this.posVertexBuffer=new i.VertexBuffer(t),this.posVertexBuffer.setData(e.posVertexInfo.array,e.posVertexInfo.type,e.posVertexInfo.size),this.posVertexBuffer.setAttrName(e.posVertexInfo.attrName),e.posIndexInfo?(this.posIndexBuffer=new o.IndexBuffer(t),this.posIndexBuffer.setData(e.posIndexInfo.array)):this.numOfElementsToDraw=this._getNumOfElementsToDraw(this.drawMethod),e.texVertexInfo&&(this.texVertexBuffer=new i.VertexBuffer(t),this.texVertexBuffer.setData(e.texVertexInfo.array,e.texVertexInfo.type,e.texVertexInfo.size),this.texVertexBuffer.setAttrName(e.texVertexInfo.attrName)),e.normalInfo&&(this.normalBuffer=new i.VertexBuffer(t),this.normalBuffer.setData(e.normalInfo.array,e.normalInfo.type,e.normalInfo.size),this.normalBuffer.setAttrName(e.normalInfo.attrName))}return t.prototype.bind=function(t){t.bind(),this.posIndexBuffer&&this.posIndexBuffer.bind(),this.posVertexBuffer&&this.posVertexBuffer.bind(t),this.texVertexBuffer&&this.texVertexBuffer.bind(t),this.normalBuffer&&this.normalBuffer.bind(t)},t.prototype.unbind=function(){this.posIndexBuffer&&this.posIndexBuffer.unbind(),this.posVertexBuffer&&this.posVertexBuffer.unbind(),this.texVertexBuffer&&this.texVertexBuffer.unbind(),this.normalBuffer&&this.normalBuffer.unbind()},t.prototype.destroy=function(){this.posVertexBuffer&&this.posVertexBuffer.destroy(),this.posIndexBuffer&&this.posIndexBuffer.destroy(),this.texVertexBuffer&&this.texVertexBuffer.destroy(),this.normalBuffer&&this.normalBuffer.destroy()},t.prototype._getNumOfElementsToDraw=function(t){switch(t){case this.gl.LINE_STRIP:case this.gl.TRIANGLE_FAN:return this.posVertexBuffer.getBufferLength()/2;default:throw new n.DebugError("unknown draw method: "+t)}},t.prototype.draw=function(){null!==this.posIndexBuffer?this.gl.drawElements(this.drawMethod,this.posIndexBuffer.getBufferLength(),this.gl.UNSIGNED_SHORT,0):this.gl.drawArrays(this.drawMethod,0,this.numOfElementsToDraw)},t}();e.BufferInfo=s},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(0),i=r(2),o=r(1),s=r(21),a=r(3),u=r(4),h=function(t){function e(e){var r=t.call(this,e)||this;return r.srcRect=new i.Rect,r.borderRadius=0,r.offset=new u.Point2d,r.fillColor.set(a.Color.NONE),r}return n.__extends(e,t),e.prototype.revalidate=function(){if(!this.getResourceLink())throw console.error(this),new o.DebugError("can not render Image: resourceLink is not specified");var t=this.game.getRenderer().getTextureInfo(this.getResourceLink().getId());0===this.width&&(this.width=t.size.width),0===this.height&&(this.height=t.size.height),0===this.srcRect.width&&(this.srcRect.width=t.size.width),0===this.srcRect.height&&(this.srcRect.height=t.size.height)},e.prototype.draw=function(){return this.game.getRenderer().drawImage(this),!0},e}(s.Shape);e.Image=h},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){}return t.prototype.fromJSON=function(t){var e=this;return void 0===t&&(t={}),Object.keys(t).forEach(function(r){e[r]=t[r]}),this.revalidate(),this},t.prototype.revalidate=function(){},t.prototype.clone=function(){return this},t}();e.CommonObject=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,i=r(0),o=r(2),s=r(1),a=r(62),u=r(17);!function(t){t.LEFT="LEFT",t.RIGHT="RIGHT",t.CENTER="CENTER",t.JUSTIFY="JUSTIFY"}(n=e.TEXT_ALIGN||(e.TEXT_ALIGN={}));var h=function(){function t(t){this.textField=t,this.allCharsCached=[],this.width=0,this.height=0,this.posX=0,this.posY=0,this.strings=[]}return t.prototype.reset=function(){this.allCharsCached=[],this.strings=[],this.posX=0,this.posY=0},t.prototype.newString=function(){this.posX=0,this.strings.length&&(this.posY+=this.textField.font.getDefaultSymbolHeight()),this.strings.push(new d)},t.prototype.addChar=function(t){this.strings[this.strings.length-1].chars.push(t),this.allCharsCached.push(t),t.destRect.setXY(this.posX,this.posY),this.posX+=t.sourceRect.width},t.prototype.addWord=function(t){var e=this;t.chars.forEach(function(t){e.addChar(t)})},t.prototype.revalidate=function(t){this.height=0,this.width=0;for(var e=0,r=this.strings;e<r.length;e++){var n=r[e];n.calcSize(t),this.height+=n.height,n.width>this.width&&(this.width=n.width)}},t.prototype.align=function(t){var e=this;if(void 0===n[t]){var r=Object.keys(n).join(", ");throw new s.DebugError("can not align text: unknown enum type of TEXT_ALIGN: "+t+", expected: "+r)}this.strings.forEach(function(r){r.align(t,e.textField)})},t}(),c=function(){return function(){this.destRect=new o.Rect,this.sourceRect=new o.Rect}}(),l=function(){function t(){this.chars=[]}return t.prototype.moveBy=function(t,e){for(var r=0,n=this.chars;r<n.length;r++){n[r].destRect.getPoint().addXY(t,e)}},t.prototype.moveTo=function(t,e){for(var r=0,n=0,i=this.chars;n<i.length;n++){var o=i[n];o.destRect.getPoint().setXY(r+t,e),r+=o.sourceRect.width}},t}(),f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.width=0,e}return i.__extends(e,t),e.prototype.revalidate=function(){this.width=0;for(var t=0,e=this.chars;t<e.length;t++){var r=e[t];this.width+=r.destRect.width}},e.prototype.addChar=function(t){this.chars.push(t),this.width+=t.sourceRect.width},e}(l),d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.width=0,e.height=0,e}return i.__extends(e,t),e.prototype.calcSize=function(t){this.width=0,this.height=t;for(var e=0,r=this.chars;e<r.length;e++){var n=r[e];this.width+=n.sourceRect.width}},e.prototype.toWords=function(){for(var t=[],e=new f,r=0,n=this.chars;r<n.length;r++){var i=n[r];" "===i.symbol?e.chars.length&&(t.push(e),e=new f):e.chars.push(i)}return-1===t.indexOf(e)&&t.push(e),t},e.prototype.align=function(t,e){switch(t){case n.LEFT:break;case n.CENTER:var r=e.width-this.width;if(r<0)return;r/=2,this.moveBy(r,0);break;case n.RIGHT:if((r=e.width-this.width)<0)return;this.moveBy(r,0);break;case n.JUSTIFY:var i=this.toWords();if(i.length<=1)return;if(!i[0].chars.length)return;var o=0;i.forEach(function(t){t.revalidate(),o+=t.width});for(var a=(e.width-o)/(i.length-1),u=this.chars[0].destRect.getPoint().y,h=this.chars[0].destRect.getPoint().x,c=0;c<i.length;c++){var l=i[c];l.moveTo(h,u),h+=l.width+a}break;default:throw new s.DebugError("unknown TEXT_ALIGN value: "+t)}},e}(l),p=function(t){function e(e){var r=t.call(this,e)||this;return r.type="TextField",r.text="",r.font=null,r.textAlign=n.LEFT,r.border=null,r._textInfo=new h(r),r._symbolImage=new u.Image(r.game),r._initScrolling({vertical:!0}),r}return i.__extends(e,t),e.prototype.revalidate=function(){if(t.prototype.revalidate.call(this),!this.font)throw new s.DebugError("font is not provided");if(!this.font.getResourceLink())throw new s.DebugError("can not render textField: font resource link is not set");this.setFont(this.font)},e.prototype._getCharInfo=function(t){var e=this.font.fontContext.symbols[t]||this.font.fontContext.symbols[" "],r=new c;return r.symbol=t,r.sourceRect=e,r.destRect.setWH(e.width,e.height),r},e.prototype.onGeometryChanged=function(){var e=this;t.prototype.onGeometryChanged.call(this);var r=this._textInfo;r.reset(),r.newString();var n=this.text.split("\n");n.forEach(function(t,i){var o=t.split(" ");o.forEach(function(n,i){for(var s=new f,a=0;a<n.length;a++){var u=e._getCharInfo(n[a]);s.addChar(u)}if(e.maxWidth&&r.posX+s.width>e.maxWidth&&i<o.length-1&&r.newString(),r.addWord(s),i<t.length-1){var h=e._getCharInfo(" ");r.addChar(h)}}),i<n.length-1&&r.newString()}),r.revalidate(this.font.getDefaultSymbolHeight()),r.align(this.textAlign),this.width=r.width,0!==this.maxHeight&&r.height>this.maxHeight?this.height=this.maxHeight:this.height=r.height,this.border&&(this.border.width=this.width,this.border.height=this.height),this.updateScrollSize(r.height,this.height)},e.prototype.setText=function(t){void 0===t&&(t=""),this.text=t.toString(),this._dirty=!0},e.prototype.getText=function(){return this.text},e.prototype.setFont=function(t){this.font=t,this.setText(this.text)},e.prototype.draw=function(){var t=this.game.getRenderer();t.lockRect(this.getScreenRect()),t.save(),this.vScrollInfo.offset&&t.translate(0,-this.vScrollInfo.offset,0),this._symbolImage.setResourceLink(this.font.getResourceLink());for(var e=0,r=this._textInfo.allCharsCached;e<r.length;e++){var n=r[e];n.destRect.y-this.vScrollInfo.offset>this.height||(n.destRect.y+n.destRect.height-this.vScrollInfo.offset<0||(this._symbolImage.srcRect.set(n.sourceRect),this._symbolImage.setXYWH(n.destRect.x,n.destRect.y,n.destRect.width,n.destRect.height),this._symbolImage.render(!0)))}return t.restore(),t.unlockRect(),this.border&&this.border.render(),!0},e}(a.ScrollableContainer);e.TextField=p},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(0),i=r(46),o=r(18),s=r(13),a=r(26),u=r(2),h=r(1),c=r(48),l=function(t){function e(e){var r=t.call(this)||this;if(r.width=0,r.height=0,r._tweens=[],r._tweenMovies=[],r._dirty=!0,r._timers=[],r._rect=new u.Rect(0,0),!e)throw new h.DebugError("can not create model '"+r.type+"': game instance not passed to model constructor");return r.game=e,r._emitter=new a.EventEmitter,r}return n.__extends(e,t),e.prototype.setIndividualBehaviour=function(t){},e.prototype.setCommonBehaviour=function(){},e.prototype.setTimer=function(t,e){var r=new i.Timer(t,e);return this._timers.push(r),r},e.prototype.tween=function(t){var e=new s.Tween(t);return this._tweens.push(e),e},e.prototype.tweenMovie=function(){var t=new c.TweenMovie(this.game);return this._tweenMovies.push(t),t},e.prototype.update=function(t,e){var r=this;this._tweens.forEach(function(e,n){e.update(t),e.isCompleted()&&r._tweens.splice(n,1)}),this._tweenMovies.forEach(function(e,n){e.update(t),e.isCompleted()&&r._tweenMovies.splice(n,1)}),this._timers.forEach(function(e){e.onUpdate(t)})},e.prototype.on=function(t,e){return this._emitter.on(t,e),e},e.prototype.off=function(t,e){this._emitter.off(t,e)},e.prototype.trigger=function(t,e){this._emitter.trigger(t,e)},e}(o.CommonObject);e.BaseModel=l},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(0),i=r(25),o=r(3),s=function(t){function e(e){var r=t.call(this,e)||this;return r.color=o.Color.BLACK.clone(),r.lineWidth=0,r.fillColor=o.Color.RGB(100,100,100),r}return n.__extends(e,t),e.prototype.setWH=function(t,e){this.setXYWH(this.pos.x,this.pos.y,t,e)},e.prototype.setXYWH=function(t,e,r,n){this.pos.x=t,this.pos.y=e,this.width=r,this.height=n,this.getRect().setXYWH(t,e,r,n)},e.prototype.getDrawableInfo=function(){return{blendMode:this.blendMode,acceptLight:!1,alpha:this.alpha}},e}(i.RenderableModel);e.Shape=s},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(0),i=r(10),o=r(4),s=r(8),a=r(2),u=function(t){function e(){return t.call(this)||this}return n.__extends(e,t),e.fromPool=function(){return e.mousePointsPool.getNextObject()},e.unTransform=function(t){var r=e.fromPool();return r.screenX=t.screenX,r.screenY=t.screenY,r.id=t.id,r.target=t.target,r.setXY(r.screenX,r.screenY),r},e.mousePointsPool=new s.ObjectPool(e),e}(o.Point2d);e.MousePoint=u,e.MOUSE_EVENTS={click:"click",mouseDown:"mouseDown",mouseMove:"mouseMove",mouseLeave:"mouseLeave",mouseEnter:"mouseEnter",mouseUp:"mouseUp",doubleClick:"doubleClick",scroll:"scroll"};var h=function(){function t(t){this.objectsCaptured={},this.game=t}return t.prototype.resolvePoint=function(t){var e=this.game,r=t.clientX,n=t.clientY,i=(r-e.pos.x)/e.scale.x,s=(n-e.pos.y)/e.scale.y,a=e.camera.screenToWorld(o.Point2d.fromPool().setXY(i,s)),h=u.fromPool();return h.set(a),h.screenX=i,h.screenY=s,h.id=t.identifier||0,h},t.triggerGameObjectEvent=function(t,e,r,n,o,s){void 0===o&&(o=0),void 0===s&&(s=0);var u=a.Rect.fromPool().clone().set(n.getRect()).addXY(o,s);return!!i.MathEx.isPointInRect(r,u)&&(r.target=n,n.trigger(e,{screenX:r.x,screenY:r.y,objectX:r.x-n.pos.x,objectY:r.y-n.pos.y,id:r.id,target:n,nativeEvent:t,eventName:e,isMouseDown:r.isMouseDown}),!0)},t.prototype.triggerChildren=function(e,r,n,i,o,s){for(var a=0;a<r.length;a++){var u=r[r.length-1-a];if(t.triggerGameObjectEvent(e,n,i,u,o,s)){this.triggerChildren(e,u.children,n,i,o+u.pos.x,s+u.pos.y);break}}},t.prototype.triggerEvent=function(e,r,n){void 0===n&&(n=!1);var i=this.game.getCurrScene();if(i){var o=this.resolvePoint(e);o.isMouseDown=n,o.target=void 0;for(var s=0,a=i.getAllGameObjects();s<a.length;s++){var h=a[s];if(t.triggerGameObjectEvent(e,r,o,h)){h.children&&this.triggerChildren(e,h.children,r,o,h.pos.x,h.pos.y);break}}for(var c=u.unTransform(o),l=0;l<i.uiLayer.children.length;l++){h=i.uiLayer.children[i.uiLayer.children.length-1-l];if(t.triggerGameObjectEvent(e,r,c,h)){h.children&&this.triggerChildren(e,h.children,r,c,h.pos.x,h.pos.y);break}}return c.target&&(o.target=c.target),void 0===o.target&&(o.target=i),i.trigger(r,{screenX:o.x,screenY:o.y,id:o.id,target:i,eventName:r,isMouseDown:n}),o}},t.prototype.resolveClick=function(t){this.triggerEvent(t,e.MOUSE_EVENTS.click),this.triggerEvent(t,e.MOUSE_EVENTS.mouseDown)},t.prototype.resolveMouseMove=function(t,r){var n=this.triggerEvent(t,e.MOUSE_EVENTS.mouseMove,r);if(n){var i=this.objectsCaptured[n.id];i&&i!==n.target&&(i.trigger(e.MOUSE_EVENTS.mouseLeave,n),delete this.objectsCaptured[n.id]),n.target&&i!==n.target&&(n.target.trigger(e.MOUSE_EVENTS.mouseEnter,n),this.objectsCaptured[n.id]=n.target)}},t.prototype.resolveMouseUp=function(t){var r=this.triggerEvent(t,e.MOUSE_EVENTS.mouseUp);if(r){var n=this.objectsCaptured[r.id];n&&(r.target!==n&&n.trigger(e.MOUSE_EVENTS.mouseUp,r),delete this.objectsCaptured[r.id])}},t.prototype.resolveDoubleClick=function(t){var r=this.triggerEvent(t,e.MOUSE_EVENTS.doubleClick);r&&delete this.objectsCaptured[r.id]},t.prototype.resolveScroll=function(t){var r=this.triggerEvent(t,e.MOUSE_EVENTS.scroll);r&&delete this.objectsCaptured[r.id]},t.prototype.listenTo=function(t){var e=this;this.container=t,t.ontouchstart=function(t){for(var r=t.touches.length;r--;)e.resolveClick(t.touches[r])},t.onmousedown=function(t){0===t.button&&e.resolveClick(t)},t.ontouchend=t.ontouchcancel=function(t){for(var r=t.changedTouches.length;r--;)e.resolveMouseUp(t.changedTouches[r])},t.onmouseup=function(t){e.resolveMouseUp(t)},t.ontouchmove=function(t){for(var r=t.touches.length;r--;)e.resolveMouseMove(t.touches[r],!0)},t.onmousemove=function(t){var r=1===t.buttons;e.resolveMouseMove(t,r)},t.ondblclick=function(t){e.resolveDoubleClick(t)},t.onmousewheel=function(t){e.resolveScroll(t)}},t.prototype.destroy=function(){var t=this;this.container&&["mouseMove","ontouchstart","onmousedown","ontouchend","onmouseup","ontouchmove","onmousemove","ondblclick"].forEach(function(e){t.container[e]=null})},t}();e.Mouse=h},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(5),i=function(){function t(){this.vertexUniforms=[],this.fragmentUniforms=[],this.attributes=[],this.varyings=[],this.appendedFragCodeBlocks=[],this.appendedVertexCodeBlocks=[],this.prependedVertexCodeBlocks=[],this.prependedFragCodeBlocks=[],this.vertexMainFn="",this.fragmentMainFn=""}return t.prototype.addVertexUniform=function(t,e){return this.vertexUniforms.push({type:t,name:e}),n.normalizeUniformName(e)},t.prototype.addFragmentUniform=function(t,e){return this.fragmentUniforms.push({type:t,name:e}),n.normalizeUniformName(e)},t.prototype.addAttribute=function(t,e){return this.attributes.push({type:t,name:e}),n.normalizeUniformName(e)},t.prototype.addVarying=function(t,e){this.varyings.push({type:t,name:e})},t.prototype.appendVertexCodeBlock=function(t){this.appendedVertexCodeBlocks.push(t)},t.prototype.appendFragmentCodeBlock=function(t){this.appendedFragCodeBlocks.push(t)},t.prototype.prependVertexCodeBlock=function(t){this.prependedVertexCodeBlocks.push(t)},t.prototype.prependFragmentCodeBlock=function(t){this.prependedFragCodeBlocks.push(t)},t.prototype.setVertexMainFn=function(t){return this.vertexMainFn=t,this},t.prototype.setFragmentMainFn=function(t){return this.fragmentMainFn=t,this},t.prototype.getVertexSource=function(){return"\n"+this.prependedVertexCodeBlocks.map(function(t){return""+t}).join("\n")+"\n\n"+this.vertexUniforms.map(function(t){return"uniform   "+t.type+" "+t.name+";"}).join("\n")+"\n"+this.attributes.map(function(t){return"attribute "+t.type+" "+t.name+";"}).join("\n")+"\n"+this.varyings.map(function(t){return"varying   "+t.type+" "+t.name+";"}).join("\n")+"\n"+this.appendedVertexCodeBlocks.map(function(t){return""+t}).join("\n")+"\n\n"+this.vertexMainFn},t.prototype.getFragmentSource=function(){return"\nprecision mediump float;\n\n"+this.prependedFragCodeBlocks.map(function(t){return""+t}).join("\n")+"\n\n"+this.fragmentUniforms.map(function(t){return"uniform "+t.type+" "+t.name+";"}).join("\n")+"\n"+this.varyings.map(function(t){return"varying "+t.type+" "+t.name+";"}).join("\n")+"\n"+this.appendedFragCodeBlocks.map(function(t){return""+t}).join("\n")+"\n\n"+this.fragmentMainFn+"\n"},t.prototype.debug=function(){console.log("// *** vertex shader source ***"),console.log(this.getVertexSource()),console.log("// *** fragment shader source ***"),console.log(this.getFragmentSource())},t}();e.ShaderGenerator=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(0),i=r(5),o=function(t){function e(){var e=t.call(this)||this;return e.addAttribute(i.GL_TYPE.FLOAT_VEC4,"a_position"),e.addAttribute(i.GL_TYPE.FLOAT_VEC2,"a_texCoord"),e.addVertexUniform(i.GL_TYPE.FLOAT_MAT4,"u_vertexMatrix"),e.addVertexUniform(i.GL_TYPE.FLOAT_MAT4,"u_textureMatrix"),e.addVarying(i.GL_TYPE.FLOAT_VEC2,"v_texCoord"),e.prependFragmentCodeBlock("\n            vec4 tint(vec4 srcColor,vec4 tintColor){\n                vec3 r = vec3(srcColor) * (1.0 - tintColor.a) +\n                    vec3(tintColor) * tintColor.a;\n                vec4 result = vec4(r,srcColor.a);\n                return result;    \n            }\n        "),e.setVertexMainFn("\n            void main(){\n                gl_Position = u_vertexMatrix * a_position;\n                v_texCoord = (u_textureMatrix * vec4(a_texCoord, 0, 1)).xy;\n            } \n        "),e.addFragmentUniform(i.GL_TYPE.SAMPLER_2D,"texture"),e.addFragmentUniform(i.GL_TYPE.FLOAT,"u_alpha"),e.setFragmentMainFn("\n            void main(){\n                gl_FragColor = texture2D(texture, v_texCoord);\n                gl_FragColor.a *= u_alpha;\n            }\n        "),e}return n.__extends(e,t),e}(r(23).ShaderGenerator);e.TexShaderGenerator=o},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(0),i=r(43),o=r(1),s=r(10),a=r(15),u=r(4),h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.pos=new u.Point2d(0,0,function(){return e._dirty=!0}),e.scale=new u.Point2d(1,1),e.anchor=new u.Point2d(0,0),e.angle=0,e.alpha=1,e.filters=[],e.children=[],e.acceptLight=!1,e.fixedToCamera=!1,e.rigid=!1,e}return n.__extends(e,t),e.prototype.findObject=function(t){if(a.isObjectMatch(this,t))return this;for(var e=0,r=this.children;e<r.length;e++){var n=r[e].findObject(t);if(n)return n}return null},e.prototype.getRect=function(){return this._rect.setXYWH(this.pos.x-this.anchor.x,this.pos.y-this.anchor.y,this.width,this.height),this._rect},e.prototype.setAnchorToCenter=function(){if(this.revalidate(),!this.width||!this.height)throw new o.DebugError("can not set anchor to center: width or height of gameObject is not set");this.anchor.setXY(this.width/2,this.height/2)},e.prototype.onShow=function(){},e.prototype.appendChild=function(t){t.parent=this,this.children.push(t),t.onShow()},e.prototype.prependChild=function(t){t.parent=this,this.children.unshift(t),t.onShow()},e.prototype._setDirty=function(){this._dirty=!0},e.prototype.beforeRender=function(){this.game.getRenderer().translate(this.pos.x,this.pos.y)},e.prototype.isNeedAdditionalTransform=function(){return!(0===this.angle&&this.scale.equal(1))},e.prototype.doAdditionalTransform=function(){this.game.getRenderer().rotateZ(this.angle),this.angleY&&this.game.getRenderer().rotateY(this.angleY)},e.prototype.isInViewPort=function(){return s.MathEx.overlapTest(this.game.camera.getRectScaled(),this.getRect())},e.prototype.moveToFront=function(){var t=this.parent.children.indexOf(this);if(-1==t)throw new o.DebugError("can not move to front: gameObject is detached");this.parent.children.splice(t,1),this.parent.children.push(this)},e.prototype.moveToBack=function(){var t=this.parent.children.indexOf(this);if(-1==t)throw new o.DebugError("can not move to back: gameObject is detached");this.parent.children.splice(t,1),this.parent.children.unshift(this)},e.prototype.kill=function(){var t=this;this.parent.children.remove(function(e){return e.id===t.id})},e.prototype.render=function(t){if(void 0===t&&(t=!1),t||this.isInViewPort()){var e=this.game.getRenderer();if(e.save(),this.beforeRender(),e.translate(-this.anchor.x,-this.anchor.y),this.isNeedAdditionalTransform()){var r=this.width/2,n=this.height/2;e.translate(r,n),e.scale(this.scale.x,this.scale.y),this.doAdditionalTransform(),e.translate(-r,-n)}if(this.draw()&&this.children.length>0){e.save(),e.translate(this.anchor.x,this.anchor.y);for(var i=0,o=this.children.length;i<o;i++)this.children[i].render();e.restore()}e.restore()}},e.prototype.update=function(e,r){t.prototype.update.call(this,e,r);for(var n=0,i=this.children;n<i.length;n++){var o=i[n];this._dirty&&o._setDirty(),o.update(e,r)}},e}(i.Resource);e.RenderableModel=h},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(1),i=function(){function t(){this.events={}}return t.prototype._on=function(t,e){this.events[t]=this.events[t]||[],this.events[t].push(e)},t.prototype.on=function(t,e){var r=this;"string"==typeof t?this._on(t,e):t.splice&&t.forEach(function(t){r._on(t,e)})},t.prototype.off=function(t,e){var r=this.events[t];if(r){var i=r.indexOf(e);if(-1==i)throw console.error(e),new n.DebugError("can not remove event listener "+t);r.splice(i,1)}},t.prototype.trigger=function(t,e){var r=this.events[t];if(r)for(var n=r.length;n--;)r[n](e)},t}();e.EventEmitter=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,i,o=r(26);!function(t){t.KEY_PRESSED="1",t.KEY_RELEASED="2",t.KEY_HOLD="3"}(n=e.KEYBOARD_EVENT||(e.KEYBOARD_EVENT={})),function(t){t[t.SPACE=32]="SPACE",t[t.A=65]="A",t[t.B=66]="B",t[t.C=67]="C",t[t.D=68]="D",t[t.E=69]="E",t[t.F=70]="F",t[t.G=71]="G",t[t.H=72]="H",t[t.I=73]="I",t[t.J=74]="J",t[t.K=75]="K",t[t.L=76]="L",t[t.M=77]="M",t[t.N=78]="N",t[t.O=79]="O",t[t.P=80]="P",t[t.Q=81]="Q",t[t.R=82]="R",t[t.S=83]="S",t[t.T=84]="T",t[t.U=85]="U",t[t.V=86]="V",t[t.W=87]="W",t[t.X=88]="X",t[t.Y=89]="Y",t[t.Z=80]="Z",t[t.LEFT=37]="LEFT",t[t.UP=38]="UP",t[t.RIGHT=39]="RIGHT",t[t.DOWN=40]="DOWN",t[t.GAME_PAD_1=0]="GAME_PAD_1",t[t.GAME_PAD_2=1]="GAME_PAD_2",t[t.GAME_PAD_3=2]="GAME_PAD_3",t[t.GAME_PAD_4=3]="GAME_PAD_4",t[t.GAME_PAD_5=4]="GAME_PAD_5",t[t.GAME_PAD_6=5]="GAME_PAD_6",t[t.GAME_PAD_7=6]="GAME_PAD_7",t[t.GAME_PAD_8=7]="GAME_PAD_8",t[t.GAME_PAD_AXIS_LEFT=8]="GAME_PAD_AXIS_LEFT",t[t.GAME_PAD_AXIS_RIGHT=9]="GAME_PAD_AXIS_RIGHT",t[t.GAME_PAD_AXIS_UP=10]="GAME_PAD_AXIS_UP",t[t.GAME_PAD_AXIS_DOWN=11]="GAME_PAD_AXIS_DOWN"}(e.KEY||(e.KEY={})),function(t){t[t.KEY_JUST_PRESSED=2]="KEY_JUST_PRESSED",t[t.KEY_PRESSED=1]="KEY_PRESSED",t[t.KEY_JUST_RELEASED=0]="KEY_JUST_RELEASED",t[t.KEY_RELEASED=-1]="KEY_RELEASED"}(i||(i={}));var s=function(){function t(t){this.buffer={},this.emitter=new o.EventEmitter,this.game=t}return t.prototype.press=function(t){this.isPressed(t)||(this.buffer[t]=i.KEY_JUST_PRESSED,this.emitter.trigger(n.KEY_PRESSED,t))},t.prototype.release=function(t){this.isReleased(t)||(this.buffer[t]=i.KEY_JUST_RELEASED,this.emitter.trigger(n.KEY_RELEASED,this.buffer[t]))},t.prototype.on=function(t,e){this.emitter.on(t,e)},t.prototype.off=function(t,e){this.emitter.off(t,e)},t.prototype.isPressed=function(t){return this.buffer[t]>=i.KEY_PRESSED},t.prototype.isJustPressed=function(t){return this.buffer[t]===i.KEY_JUST_PRESSED},t.prototype.isReleased=function(t){return void 0===this.buffer[t]||this.buffer[t]<=i.KEY_JUST_RELEASED},t.prototype.isJustReleased=function(t){return this.buffer[t]===i.KEY_JUST_RELEASED},t.prototype.update=function(){var t=this;Object.keys(this.buffer).forEach(function(e){var r=+e;t.buffer[r]===i.KEY_RELEASED?delete t.buffer[r]:t.buffer[r]===i.KEY_JUST_RELEASED&&(t.buffer[r]=i.KEY_RELEASED),t.buffer[r]===i.KEY_JUST_PRESSED&&(t.buffer[r]=i.KEY_PRESSED),t.emitter.trigger(n.KEY_HOLD,r)})},t.prototype.listenTo=function(){var t=this;this.keyDownListener=function(e){var r=e.keyCode;t.press(r)},this.keyUpListener=function(e){var r=e.keyCode;t.release(r)},window.addEventListener("keydown",this.keyDownListener),window.addEventListener("keyup",this.keyUpListener)},t.prototype.destroy=function(){window.removeEventListener("keydown",this.keyDownListener),window.removeEventListener("keyup",this.keyUpListener)},t}();e.Keyboard=s},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.currState=[],this.setState.apply(this,t)}return t.prototype.setState=function(){for(var t=this,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var n=!1;return e.forEach(function(e,r){t.currState[r]!==e&&(n=!0),t.currState[r]=e}),n},t}(),i=function(){function t(){this._state=new n,this._onChanged=[]}return t.prototype.triggerObservable=function(){if(this.checkObservableChanged())for(var t=0,e=this._onChanged;t<e.length;t++){(0,e[t])()}},t.prototype.addListener=function(t){this._onChanged.push(t)},t.prototype.removeListener=function(t){this._onChanged.remove(t)},t}();e.ObservableEntity=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(0),i=r(1),o=function(){function t(t,e){this.x=t,this.y=e}return t.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},t.prototype.add=function(e){return new t(e.x+this.x,e.y+this.y)},t.prototype.subtract=function(e){return new t(this.x-e.x,this.y-e.y)},t.prototype.scale=function(e){return new t(this.x*e,this.y*e)},t.prototype.dot=function(t){return this.x*t.x+this.y*t.y},t.prototype.cross=function(t){return this.x*t.y-this.y*t.x},t.prototype.rotate=function(e,r){var n=[],i=this.x-e.x,o=this.y-e.y;return n[0]=i*Math.cos(r)-o*Math.sin(r),n[1]=i*Math.sin(r)+o*Math.cos(r),n[0]+=e.x,n[1]+=e.y,new t(n[0],n[1])},t.prototype.normalize=function(){var e=this.length();return e>0&&(e=1/e),new t(this.x*e,this.y*e)},t.prototype.distance=function(t){var e=this.x-t.x,r=this.y-t.y;return Math.sqrt(e*e+r*r)},t}();e.Vec2=o;var s=function(){function t(){this.mDepth=0,this.mNormal=new o(0,0),this.mStart=new o(0,0),this.mEnd=new o(0,0)}return t.prototype.setDepth=function(t){this.mDepth=t},t.prototype.setNormal=function(t){this.mNormal=t},t.prototype.getDepth=function(){return this.mDepth},t.prototype.getNormal=function(){return this.mNormal},t.prototype.setInfo=function(t,e,r){this.mDepth=t,this.mNormal=e,this.mStart=r,this.mEnd=r.add(e.scale(t))},t.prototype.changeDir=function(){this.mNormal=this.mNormal.scale(-1);var t=this.mStart;this.mStart=this.mEnd,this.mEnd=t},t}();e.CollisionInfo=s;var a=function(){function t(t,e,r,n,i){this.fixedAngle=!1,this.mVelocity=new o(0,0),this.mAngle=0,this.mAngularVelocity=0,this.mAngularAcceleration=0,this.mBoundRadius=0,this.game=t,this.mCenter=e,this.mInertia=0,this.fixedAngle=!1,this.mInvMass=void 0!==r?r:1,this.mFriction=void 0!==n?n:.2,this.mRestitution=void 0!==i?i:.1,0!==this.mInvMass?(this.mInvMass=1/this.mInvMass,this.mAcceleration=new o(0,t.gravityConstant)):this.mAcceleration=new o(0,0)}return t.prototype.updateMass=function(t){var e;e=0!==this.mInvMass?1/this.mInvMass:0,(e+=t)<=0?(this.mInvMass=0,this.mVelocity=new o(0,0),this.mAcceleration=new o(0,0),this.mAngularVelocity=0,this.mAngularAcceleration=0):(this.mInvMass=1/e,this.mAcceleration=new o(0,this.game.gravityConstant)),this.updateInertia()},t.prototype.update=function(t,e){var r=e/1e3;this.mVelocity=this.mVelocity.add(this.mAcceleration.scale(r)),this.move(this.mVelocity.scale(r)),this.mAngularVelocity+=this.mAngularAcceleration*r,this.rotate(this.mAngularVelocity*r)},t.prototype.boundTest=function(t){var e=t.mCenter.subtract(this.mCenter),r=this.mBoundRadius+t.mBoundRadius;return e.length()<=r},t}();e.RigidShape=a;var u=function(t){function e(e,r,n,i,s,a){var u=t.call(this,e,r,i,s,a)||this;return u.mType="Circle",u.mRadius=n,u.mBoundRadius=n,u.mStartpoint=new o(r.x,r.y-n),u.updateInertia(),u}return n.__extends(e,t),e.prototype.move=function(t){return this.mStartpoint=this.mStartpoint.add(t),this.mCenter=this.mCenter.add(t),this},e.prototype.rotate=function(t){return this.mAngle+=t,this.mStartpoint=this.mStartpoint.rotate(this.mCenter,t),this},e.prototype.updateInertia=function(){0===this.mInvMass?this.mInertia=0:this.mInertia=1/this.mInvMass*(this.mRadius*this.mRadius)/12},e.prototype.collisionTest=function(t,r){if(e.isInstanceOf(t))return this.collidedCircCirc(this,t,r);if(f.isInstanceOf(t))return t.collidedRectCirc(this,r);throw console.error(this,t),new i.DebugError("collision test error")},e.prototype.collidedCircCirc=function(t,e,r){var n=e.mCenter.subtract(t.mCenter),i=t.mRadius+e.mRadius,s=n.length();if(s>Math.sqrt(i*i))return!1;if(0!==s){var a=n.scale(-1).normalize().scale(e.mRadius);r.setInfo(i-s,n.normalize(),e.mCenter.add(a))}else t.mRadius>e.mRadius?r.setInfo(i,new o(0,-1),t.mCenter.add(new o(0,t.mRadius))):r.setInfo(i,new o(0,-1),e.mCenter.add(new o(0,e.mRadius)));return!0},e.isInstanceOf=function(t){return"Circle"===t.mType},e}(a);e.RigidCircle=u;var h=new(function(){return function(){this.mSupportPointDist=0}}()),c=new s,l=new s,f=function(t){function e(e,r,n,i,s,a,u){var h=t.call(this,e,r,s,a,u)||this;return h.mType="Rectangle",h.mVertex=[],h.mFaceNormal=[],h.mWidth=n,h.mHeight=i,h.mBoundRadius=Math.sqrt(n*n+i*i)/2,h.mVertex[0]=new o(r.x-n/2,r.y-i/2),h.mVertex[1]=new o(r.x+n/2,r.y-i/2),h.mVertex[2]=new o(r.x+n/2,r.y+i/2),h.mVertex[3]=new o(r.x-n/2,r.y+i/2),h.mFaceNormal[0]=h.mVertex[1].subtract(h.mVertex[2]),h.mFaceNormal[0]=h.mFaceNormal[0].normalize(),h.mFaceNormal[1]=h.mVertex[2].subtract(h.mVertex[3]),h.mFaceNormal[1]=h.mFaceNormal[1].normalize(),h.mFaceNormal[2]=h.mVertex[3].subtract(h.mVertex[0]),h.mFaceNormal[2]=h.mFaceNormal[2].normalize(),h.mFaceNormal[3]=h.mVertex[0].subtract(h.mVertex[1]),h.mFaceNormal[3]=h.mFaceNormal[3].normalize(),h.updateInertia(),h}return n.__extends(e,t),e.prototype.rotate=function(t){this.mAngle+=t;for(var e=0;e<this.mVertex.length;e++)this.mVertex[e]=this.mVertex[e].rotate(this.mCenter,t);return this.mFaceNormal[0]=this.mVertex[1].subtract(this.mVertex[2]),this.mFaceNormal[0]=this.mFaceNormal[0].normalize(),this.mFaceNormal[1]=this.mVertex[2].subtract(this.mVertex[3]),this.mFaceNormal[1]=this.mFaceNormal[1].normalize(),this.mFaceNormal[2]=this.mVertex[3].subtract(this.mVertex[0]),this.mFaceNormal[2]=this.mFaceNormal[2].normalize(),this.mFaceNormal[3]=this.mVertex[0].subtract(this.mVertex[1]),this.mFaceNormal[3]=this.mFaceNormal[3].normalize(),this},e.prototype.move=function(t){for(var e=0;e<this.mVertex.length;e++)this.mVertex[e]=this.mVertex[e].add(t);return this.mCenter=this.mCenter.add(t),this},e.prototype.updateInertia=function(){0===this.mInvMass?this.mInertia=0:(this.mInertia=1/this.mInvMass*(this.mWidth*this.mWidth+this.mHeight*this.mHeight)/12,this.mInertia=1/this.mInertia)},e.prototype.collisionTest=function(t,r){if(u.isInstanceOf(t))return this.collidedRectCirc(t,r);if(e.isInstanceOf(t))return this.collidedRectRect(this,t,r);throw console.error(this,t),new i.DebugError("collision test error")},e.prototype.boundTest=function(t){var e=t.mCenter.subtract(this.mCenter),r=this.mBoundRadius+t.mBoundRadius;return e.length()<=r},e.prototype.findSupportPoint=function(t,e){var r;h.mSupportPointDist=-9999999,h.mSupportPoint=null;for(var n=0;n<this.mVertex.length;n++)(r=this.mVertex[n].subtract(e).dot(t))>0&&r>h.mSupportPointDist&&(h.mSupportPoint=this.mVertex[n],h.mSupportPointDist=r)},e.prototype.findAxisLeastPenetration=function(t,e){for(var r,n=999999,i=null,o=!0,s=0;o&&s<this.mFaceNormal.length;){var a=this.mFaceNormal[s].scale(-1),u=this.mVertex[s];t.findSupportPoint(a,u),(o=null!==h.mSupportPoint)&&h.mSupportPointDist<n&&(n=h.mSupportPointDist,i=s,r=h.mSupportPoint),s+=1}if(o){var c=this.mFaceNormal[i].scale(n);e.setInfo(n,this.mFaceNormal[i],r.add(c))}return o},e.prototype.collidedRectRect=function(t,e,r){var n,i;if((n=t.findAxisLeastPenetration(e,c))&&(i=e.findAxisLeastPenetration(t,l)))if(c.getDepth()<l.getDepth()){var o=c.getNormal().scale(c.getDepth());r.setInfo(c.getDepth(),c.getNormal(),c.mStart.subtract(o))}else r.setInfo(l.getDepth(),l.getNormal().scale(-1),l.mStart);return n&&i},e.prototype.collidedRectCirc=function(t,e){var r,n,i,o,s,a,u=!0,h=-99999,c=0;for(r=0;r<4;r++){if((i=(n=t.mCenter).subtract(this.mVertex[r]).dot(this.mFaceNormal[r]))>0){h=i,c=r,u=!1;break}i>h&&(h=i,c=r)}if(u)a=this.mFaceNormal[c].scale(t.mRadius),e.setInfo(t.mRadius-h,this.mFaceNormal[c],n.subtract(a));else{var l=n.subtract(this.mVertex[c]),f=this.mVertex[(c+1)%4].subtract(this.mVertex[c]),d=l.dot(f);if(d<0){if((o=l.length())>t.mRadius)return!1;a=(s=l.normalize()).scale(-t.mRadius),e.setInfo(t.mRadius-o,s,n.add(a))}else if(l=n.subtract(this.mVertex[(c+1)%4]),f=f.scale(-1),(d=l.dot(f))<0){if((o=l.length())>t.mRadius)return!1;a=(s=l.normalize()).scale(-t.mRadius),e.setInfo(t.mRadius-o,s,n.add(a))}else{if(!(h<t.mRadius))return!1;a=this.mFaceNormal[c].scale(t.mRadius),e.setInfo(t.mRadius-h,this.mFaceNormal[c],n.subtract(a))}}return!0},e.isInstanceOf=function(t){return"Rectangle"===t.mType},e}(a);e.RigidRectangle=f},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(1),i=r(3),o=function(){return function(t){if(this.color=i.Color.WHITE,this.intensity=1,!t)throw new n.DebugError("game instanse is not passed to AbstractLight constructor");this.game=t}}();e.AbstractLight=o},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,i=r(1),o=r(13),s=r(9),a=r(10),u=r(2),h=r(4);!function(t){t[t.MODE_TRANSFORM=0]="MODE_TRANSFORM",t[t.MODE_IDENTITY=1]="MODE_IDENTITY"}(n=e.CAMERA_MATRIX_MODE||(e.CAMERA_MATRIX_MODE={}));var c=function(){function t(t){var e=this;this.objFollowTo=null,this.scene=null,this.sceneWidth=0,this.sceneHeight=0,this.pos=new h.Point2d(0,0),this.scale=new h.Point2d(1,1),this.matrixMode=n.MODE_TRANSFORM,this._rect=new u.Rect,this._rectIdentity=new u.Rect,this._rectScaled=new u.Rect,this.cameraShakeTween=null,this.cameraPosCorrection={current:new h.Point2d,max:new h.Point2d},this.game=t,this._updateRect(),this.sceneWidth=t.width,this.sceneHeight=t.height,this.scale.observe(function(){e.revalidate()})}return t.prototype.revalidate=function(){this.scene=this.game.getCurrScene(),this.scene&&(this.scene.tileMap&&this.scene.tileMap.revalidate(),this._rectIdentity.setXYWH(0,0,this.game.width,this.game.height),this.scene.tileMap.spriteSheet?(this.sceneWidth=this.scene.tileMap.spriteSheet._frameWidth*this.scene.tileMap.width,this.sceneHeight=this.scene.tileMap.spriteSheet._frameHeight*this.scene.tileMap.height):(this.sceneWidth=this.game.getCurrScene().width||this.game.width,this.sceneHeight=this.game.getCurrScene().height||this.game.height))},t.prototype.followTo=function(t){if(null!==t){if(void 0===t)throw new i.DebugError("Camera:followTo(gameObject) - gameObject not provided");this.objFollowTo=t,this.revalidate()}},t.prototype.update=function(t,e){this.scene=this.game.getCurrScene();var r=this.scene.tileMap.spriteSheet?this.scene.tileMap.spriteSheet._frameWidth:0,n=this.scene.tileMap.spriteSheet?this.scene.tileMap.spriteSheet._frameHeight:0,i=this.game.width,o=this.game.height,s=i/2,a=o/2,u=this.getRectScaled().width,c=this.objFollowTo;if(c){"Right"===c._lastDirection&&(this.cameraPosCorrection.max.x=u/3),"Left"===c._lastDirection&&(this.cameraPosCorrection.max.x=-u/3);var l=this.cameraPosCorrection.max.substract(this.cameraPosCorrection.current).multiply(.05);this.cameraPosCorrection.current.add(l);var f=h.Point2d.fromPool(),d=h.Point2d.fromPool();d.set(this.objFollowTo.pos),d.addXY(-s,-a),f.x=this.pos.x+.1*(d.x+this.cameraPosCorrection.current.x-this.pos.x),f.y=this.pos.y+.1*(d.y-this.pos.y),f.x<0&&(f.x=0),f.y<0&&(f.y=0),f.x>this.sceneWidth-i+r&&(f.x=this.sceneWidth-i+r),f.y>this.sceneHeight-o+n&&(f.y=this.sceneHeight-o+n),this.pos.setXY(f.x,f.y),this.cameraShakeTween&&this.cameraShakeTween.update(t)}this._updateRect(),this.render()},t.prototype.shake=function(t,e){var r=this,n={time:0,point:new h.Point2d(0,0)};this.cameraShakeTween=new o.Tween({target:n,time:e,to:{time:e},progress:function(){var e=a.MathEx.random(-t/2,t/2),r=a.MathEx.random(-t/2,t/2);n.point.setXY(e,r)},complete:function(){return r.cameraShakeTween=null}})},t.prototype._updateRect=function(){var t=this.screenToWorld(h.Point2d.fromPool().setXY(0,0)),e=this.screenToWorld(h.Point2d.fromPool().setXY(this.game.width,this.game.height));this._rectScaled.setXYWH(t.x,t.y,e.x-t.x,e.y-t.y)},t.prototype.render=function(){var t=this.game.getRenderer();t.translate(this.game.width/2,this.game.height/2),t.scale(this.scale.x,this.scale.y),t.translate(-this.game.width/2,-this.game.height/2),t.translate(-this.pos.x,-this.pos.y),null!==this.cameraShakeTween&&t.translate(this.cameraShakeTween.getTarget().point.x,this.cameraShakeTween.getTarget().point.y)},t.prototype.screenToWorld=function(t){var e=s.makeScale(this.scale.x,this.scale.y,1),r=a.MathEx.unProject(t,this.game.width,this.game.height,e);return r.add(this.pos),r},t.prototype.getRect=function(){return this.matrixMode===n.MODE_IDENTITY?this._rectIdentity:(this._rect.setXYWH(this.pos.x,this.pos.y,this.game.width,this.game.height),this._rect)},t.prototype.getRectScaled=function(){return this.matrixMode===n.MODE_IDENTITY?this._rectIdentity:this._rectScaled},t}();e.Camera=c},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.NO_SCALE=0]="NO_SCALE",t[t.FIT=1]="FIT",t[t.STRETCH=2]="STRETCH"}(e.SCALE_STRATEGY||(e.SCALE_STRATEGY={}))},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(44);e.Button=n.Button;var i=r(19);e.TextField=i.TextField;var o=r(34);e.VScroll=o.VScroll;var s=r(63);e.CheckBox=s.CheckBox;var a=r(6);e.Container=a.Container;var u=r(17);e.Image=u.Image;var h=r(12);e.Rectangle=h.Rectangle;var c=r(64);e.Circle=c.Circle;var l=r(35);e.Ellipse=l.Ellipse;var f=r(65);e.Border=f.Border;var d=r(66);e.NinePatchImage=d.NinePatchImage;var p=r(67);e.AbsoluteLayout=p.AbsoluteLayout;var g=r(3);e.Color=g.Color;var m=r(68);e.LinearGradient=m.LinearGradient},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(0),i=r(6),o=r(12),s=r(3),a=function(t){function e(e){var r=t.call(this,e)||this;r.maxValue=0,r.value=0,r.enabled=!1;var n=new o.Rectangle(e);n.width=5,n.fillColor=new s.Color(50,50,50,10),n.color=s.Color.NONE.clone();var i=new o.Rectangle(e);return i.height=10,i.color=s.Color.NONE.clone(),i.fillColor=new s.Color(10,10,10,100),r.background=n,r.handler=i,r.appendChild(n),r.appendChild(i),r}return n.__extends(e,t),e.prototype.onGeometryChanged=function(){this.handler.width=this.background.width,this.value>this.maxValue&&(this.value=this.maxValue),this.maxValue&&(this.handler.height=this.height*this.height/this.maxValue),this.maxValue&&(this.handler.pos.y=this.height*this.value/this.maxValue),this.background.revalidate(),this.handler.revalidate(),this.calcDrawableRect(this.width,this.height)},e.prototype.draw=function(){return this.enabled},e}(i.Container);e.VScroll=a},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(0),i=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.radiusX=10,e.radiusY=20,e}return n.__extends(e,t),e.prototype.draw=function(){return this.game.getRenderer().drawEllipse(this),!0},e}(r(21).Shape);e.Ellipse=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(70),i=r(72),o=r(73),s=r(74),a=r(13),u=function(){function t(e){this.game=e,this.tweens=[],n.WebAudioContext.isAcceptable()?this.contextClass=n.WebAudioContext:i.HtmlAudioContext.isAcceptable()?this.contextClass=i.HtmlAudioContext:this.contextClass=o.FakeAudioContext,this.audioNodeSet=new s.AudioNodeSet(e,this.contextClass,t.DEFAULT_AUDIO_NODES_COUNT)}return t.prototype.loadSound=function(t,e,r){new this.contextClass(this.game).load(t,e,r)},t.prototype.play=function(t){var e=this.audioNodeSet.getFreeNode();e||console.log("no free node to play sound"),e&&e.play(t.resourcePath,t.loop)},t.prototype.stop=function(t){var e=this.audioNodeSet.getNodeBySound(t);e&&e.stop()},t.prototype.stopAll=function(){this.audioNodeSet.stopAll()},t.prototype.pauseAll=function(){this.audioNodeSet.pauseAll()},t.prototype.resumeAll=function(){this.audioNodeSet.resumeAll()},t.prototype.setGain=function(t,e,r){var n=this;void 0===r&&(r=0);var i=this.audioNodeSet.getNodeBySound(t);if(i)if(r){var o=new a.Tween({target:t,to:{_gain:e},time:r,progress:function(t){i.setGain(t._gain)},complete:function(){n.tweens.remove(o)}});this.tweens.push(o)}else t._gain=e,i.setGain(t._gain)},t.prototype.update=function(t,e){this.tweens.forEach(function(e){e.update(t)})},t.cache={},t.DEFAULT_AUDIO_NODES_COUNT=6,t}();e.AudioPlayer=u},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){return function(){}}();e.AbstractPrimitive=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(0),i=function(t){function e(){var e=t.call(this)||this;return e.vertexArr=[0,0,0,1,1,0,1,1],e.indexArr=[0,1,2,3],e.texCoordArr=[0,0,0,1,1,0,1,1],e}return n.__extends(e,t),e}(r(37).AbstractPrimitive);e.Plane=i},function(t,e,r){"use strict";var n,i;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.ELLIPSE=0]="ELLIPSE",t[t.RECT=1]="RECT"}(n=e.SHAPE_TYPE||(e.SHAPE_TYPE={})),function(t){t[t.COLOR=0]="COLOR",t[t.TEXTURE=1]="TEXTURE",t[t.LINEAR_GRADIENT=2]="LINEAR_GRADIENT"}(i=e.FILL_TYPE||(e.FILL_TYPE={})),e.fragmentSource="\n\n#define HALF .5\n#define ZERO  0.\n#define ONE   1.\n#define ERROR_COLOR vec4(ONE,ZERO,ZERO,ONE)\n\nvec4 getFillColor(){\n    if (u_fillType=="+i.COLOR+") return u_fillColor;\n    else if (u_fillType=="+i.LINEAR_GRADIENT+") {\n        vec2 polarCoords = vec2(length(v_position.xy),atan(v_position.y/v_position.x));\n        polarCoords.y+=u_fillLinearGradient[2].x;\n        vec2 rectCoords = vec2(polarCoords.x*cos(polarCoords.y),polarCoords.x*sin(polarCoords.y));\n        return mix(u_fillLinearGradient[0],u_fillLinearGradient[1],rectCoords.x);\n        //return vec4(u_fillLinearGradient[0].x,u_fillLinearGradient[0].y,u_fillLinearGradient[0].z,ONE);\n    }\n    else if (u_fillType=="+i.TEXTURE+") {\n        float tx = (v_position.x-u_rectOffsetLeft)/u_width*u_texRect[2]; \n        float ty = (v_position.y-u_rectOffsetTop)/u_height*u_texRect[3];\n        vec2 txVec = vec2(tx,ty);\n        txVec += fract(u_texOffset);\n        txVec = mod(txVec,u_texRect.zw);\n        txVec += u_texRect.xy;\n        return texture2D(texture, txVec);\n    }\n    else return ERROR_COLOR;\n}\nfloat calcRadiusAtAngle(float x,float y) {\n     float a = atan(y-HALF,x-HALF);\n     float cosA = cos(a);\n     float sinA = sin(a);\n     return u_rx*u_ry/sqrt(u_rx*u_rx*sinA*sinA+u_ry*u_ry*cosA*cosA);\n}\nvoid drawEllipse(){\n     float dist = distance(vec2(HALF,HALF),v_position.xy);\n     float rAtCurrAngle = calcRadiusAtAngle(v_position.x,v_position.y);\n     if (dist < rAtCurrAngle) {\n        if (dist > rAtCurrAngle - u_lineWidth) gl_FragColor = u_color;\n        else gl_FragColor = getFillColor();\n     }\n     else discard;\n}\nvoid drawRect(){\n    float x = v_position.x - HALF;\n    float y = v_position.y - HALF;\n    float distX = abs(x);\n    float distY = abs(y);\n    float halfW = u_width  * HALF;\n    float halfH = u_height * HALF;\n    if (distX < halfW && distY < halfH) {\n        \n        if (distX>halfW - u_borderRadius && distY>halfH - u_borderRadius) {\n            vec2 borderCenter = vec2(0.,0.);\n            float posX = v_position.x, posY = v_position.y;\n            if (posX<HALF && posY<HALF) { // top left\n                borderCenter = vec2(HALF - halfW + u_borderRadius,HALF - halfH + u_borderRadius);\n            }\n            else if (posX>HALF && posY<HALF) { // top right\n                borderCenter = vec2(HALF + halfW - u_borderRadius,HALF - halfH + u_borderRadius); \n            }    \n            else if (posX<HALF && posY>HALF) { // bottom left\n                borderCenter = vec2(HALF - halfW + u_borderRadius,HALF + halfH - u_borderRadius); \n            }\n            else {  // bottom right\n                borderCenter = vec2(HALF + halfW - u_borderRadius,HALF + halfH - u_borderRadius);\n            }\n            float distToBorderCenter = distance(v_position.xy,borderCenter);\n            if (distToBorderCenter>u_borderRadius) discard;\n            else if (distToBorderCenter>u_borderRadius-u_lineWidth) gl_FragColor = u_color;\n            else gl_FragColor = getFillColor();\n        }\n        \n        else if (distX > halfW - u_lineWidth || distY > halfH - u_lineWidth)\n            gl_FragColor = u_color;\n        else \n            gl_FragColor = getFillColor();\n    }\n    else discard;\n}\n\nvoid main(){\n    if (u_shapeType=="+n.ELLIPSE+") drawEllipse();\n    else if (u_shapeType=="+n.RECT+") drawRect();\n    else gl_FragColor = ERROR_COLOR;\n    gl_FragColor.a*=u_alpha;\n}\n\n\n\n"},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(1),i=r(41),o=function(){function t(t,e,r){if(!t)throw new n.DebugError("can not create FrameBuffer, gl context not passed to constructor, expected: FrameBuffer(gl)");this.gl=t,this.width=e,this.height=r,this.texture=new i.Texture(t),this.texture.setImage(null,e,r),this._init(t,e,r)}return t.prototype._init=function(t,e,r){if(this.glRenderBuffer=t.createRenderbuffer(),!this.glRenderBuffer)throw new n.DebugError("can not allocate memory for glRenderBuffer");if(t.bindRenderbuffer(t.RENDERBUFFER,this.glRenderBuffer),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,e,r),this.glFrameBuffer=t.createFramebuffer(),!this.glFrameBuffer)throw new n.DebugError("can not allocate memory for glFrameBuffer");t.bindFramebuffer(t.FRAMEBUFFER,this.glFrameBuffer),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture.getGlTexture(),0),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.glRenderBuffer);var i=t.checkFramebufferStatus(t.FRAMEBUFFER);if(i!==t.FRAMEBUFFER_COMPLETE)throw new n.DebugError("frame buffer status error: "+i+" (expected gl.FRAMEBUFFER_COMPLETE("+t.FRAMEBUFFER_COMPLETE+"))");this.texture.unbind(),t.bindRenderbuffer(t.RENDERBUFFER,null),t.bindFramebuffer(t.FRAMEBUFFER,null)},t.prototype.bind=function(){t.currInstance!==this&&(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.glFrameBuffer),this.gl.viewport(0,0,this.width,this.height),t.currInstance=this)},t.prototype.unbind=function(){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),t.currInstance=null},t.prototype.destroy=function(){this.gl.deleteRenderbuffer(this.glRenderBuffer),this.gl.deleteFramebuffer(this.glFrameBuffer)},t.prototype.getTexture=function(){return this.texture},t.currInstance=null,t}();e.FrameBuffer=o},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(1),i=r(40),o=r(14),s=function(t){return 0==(t&t-1)},a=function(){function t(t){this.buffers=[],this.parent=t}return t.prototype.instantiate=function(t){this.gl=t;for(var e=0;e<2;e++)this.buffers.push(new i.FrameBuffer(t,this.parent.size.width,this.parent.size.height))},t.prototype.flip=function(){var t=this.buffers[0];this.buffers[0]=this.buffers[1],this.buffers[1]=t},t.prototype.getSourceBuffer=function(){return this.buffers[0]},t.prototype.getDestBuffer=function(){return this.buffers[1]},t.prototype.destroy=function(){this.buffers&&this.buffers.forEach(function(t){return t.destroy()})},t}(),u=function(){function t(e){if(this.tex=null,this.size=new o.Size(0,0),this.isPowerOfTwo=!1,this._texFilterBuff=null,!e)throw new n.DebugError("can not create Texture, gl context not passed to constructor, expected: Texture(gl)");if(this.gl=e,t.MAX_TEXTURE_IMAGE_UNITS||(t.MAX_TEXTURE_IMAGE_UNITS=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)),this.tex=e.createTexture(),!this.tex)throw new n.DebugError("can not allocate memory for texture");e.bindTexture(e.TEXTURE_2D,this.tex),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array([0,255,0,255])),e.bindTexture(e.TEXTURE_2D,this.tex),this._texFilterBuff=new a(this)}return t.prototype.setImage=function(t,e,r){if(void 0===e&&(e=0),void 0===r&&(r=0),!(t||e||r))throw new n.DebugError("texture.setImage: if image is null, width and height must be specified: tex.setImage(null,w,h)");var i=this.gl;t?this.size.setWH(t.width,t.height):this.size.setWH(e,r),i.bindTexture(i.TEXTURE_2D,this.tex),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),t?i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,t):i.texImage2D(i.TEXTURE_2D,0,i.RGBA,e,r,0,i.RGBA,i.UNSIGNED_BYTE,null),this.isPowerOfTwo=!!t&&(s(t.width)&&s(t.height)),this.isPowerOfTwo?(i.generateMipmap(i.TEXTURE_2D),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.REPEAT),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.REPEAT)):(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR)),i.bindTexture(i.TEXTURE_2D,null)},t.prototype.applyFilters=function(t,e){if(void 0===e)throw new n.DebugError("can not apply filters. frameBuffer must be explicitly passed. Pass null if no frame buffer needs to bind after filtering");var r=t.length;if(0===r)return this;this._texFilterBuff.buffers.length||this._texFilterBuff.instantiate(this.gl);var i=[{texture:this,name:"texture"}];t[0].doFilter(i,this._texFilterBuff.getDestBuffer());for(var o=1;o<r;o++){this._texFilterBuff.flip();var s=[{texture:this._texFilterBuff.getSourceBuffer().texture,name:"texture"}];t[o].doFilter(s,this._texFilterBuff.getDestBuffer())}return this._texFilterBuff.flip(),null!==e&&e.bind(),this._texFilterBuff.getSourceBuffer().texture},t.prototype.bind=function(e,r,i){if(!e)throw console.error(this),new n.DebugError("can not bind texture: uniform name was not provided");if(r>t.MAX_TEXTURE_IMAGE_UNITS-1)throw new n.DebugError("can not bind texture with index "+r+". Max supported value by device is "+t.MAX_TEXTURE_IMAGE_UNITS);if(i.setUniform(e,r),t.currInstances[r]!==this){var o=this.gl;o.activeTexture(o.TEXTURE0+r),o.bindTexture(o.TEXTURE_2D,this.tex),t.currInstances[r]=this}},t.prototype.unbind=function(e){void 0===e&&(e=0);var r=this.gl;r.activeTexture(r.TEXTURE0+e),r.bindTexture(r.TEXTURE_2D,null),delete t.currInstances[e]},t.prototype.getColorArray=function(){var t=this.gl,e=this.size.width*this.size.height;if(t.checkFramebufferStatus(t.FRAMEBUFFER)!==t.FRAMEBUFFER_COMPLETE)throw new n.DebugError("Texture.GetColorArray() failed!");var r=new Uint8Array(4*e);return t.readPixels(0,0,this.size.width,this.size.height,t.RGBA,t.UNSIGNED_BYTE,r),r},t.prototype.destroy=function(){this._texFilterBuff&&this._texFilterBuff.destroy(),this.gl.deleteTexture(this.tex)},t.prototype.getSize=function(){return this.size},t.prototype.getGlTexture=function(){return this.tex},t.MAX_TEXTURE_IMAGE_UNITS=0,t.currInstances={},t}();e.Texture=u},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(0),i=r(38),o=r(7),s=r(11),a=r(16),u=r(24),h=function(t){function e(e,r){var n=t.call(this,e)||this,s=new u.TexShaderGenerator;return n.primitive=new i.Plane,n.program=r||new o.ShaderProgram(e,s.getVertexSource(),s.getFragmentSource()),n.bufferInfo=new a.BufferInfo(e,{posVertexInfo:{array:n.primitive.vertexArr,type:e.FLOAT,size:2,attrName:"a_position"},posIndexInfo:{array:n.primitive.indexArr},texVertexInfo:{array:n.primitive.texCoordArr,type:e.FLOAT,size:2,attrName:"a_texCoord"},drawMethod:n.gl.TRIANGLE_STRIP}),n}return n.__extends(e,t),e}(s.AbstractDrawer);e.SpriteRectDrawer=h},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(0),i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n.__extends(e,t),e.prototype.setResourceLink=function(t){this._resourceLink=t},e.prototype.getResourceLink=function(){return this._resourceLink},e}(r(20).BaseModel);e.Resource=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(0),i=r(6),o=r(19),s=function(t){function e(e){var r=t.call(this,e)||this;return r.font=null,r._textField=new o.TextField(e),r.appendChild(r._textField),r}return n.__extends(e,t),e.prototype.revalidate=function(){t.prototype.revalidate.call(this),this._textField.setFont(this.font),this.onGeometryChanged()},e.prototype.onGeometryChanged=function(){if(this._textField.onGeometryChanged(),this.calcDrawableRect(this._textField.width,this._textField.height),this.background){var t=(this.background.width-this._textField.width)/2,e=(this.background.height-this._textField.height)/2;this._textField.pos.setXY(t,e)}},e.prototype.setText=function(t){this._textField.setText(t),this._dirty=!0},e.prototype.setFont=function(t){this.font=t,this._textField.setFont(t)},e.prototype.getText=function(){return this._textField.getText()},e.prototype.update=function(e,r){t.prototype.update.call(this,e,r)},e.prototype.draw=function(){return this.background&&this.background.draw(),this._textField.render(),!0},e}(i.Container);e.Button=s},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(0),i=r(20),o=r(49),s=r(50),a=r(51),u=r(3),h=r(31),c=r(15),l=r(52),f=function(t){function e(e){var r=t.call(this,e)||this;return r.type="Scene",r.layers=[],r.useBG=!1,r.colorBG=u.Color.WHITE,r.filters=[],r.tileMap=new o.TileMap(e),r.ambientLight=new a.AmbientLight(e),r.uiLayer=new s.Layer(r.game),r.addLayer(new s.Layer(e)),r.resourceLoader=new l.ResourceLoader(e),r}return n.__extends(e,t),e.prototype.revalidate=function(){t.prototype.revalidate.call(this)},e.prototype.addTweenMovie=function(t){this._tweenMovies.push(t)},e.prototype.getAllGameObjects=function(){for(var t=[],e=0;e<this.layers.length;e++)for(var r=this.layers[this.layers.length-1-e],n=0;n<r.children.length;n++){var i=r.children[r.children.length-1-n];t.push(i)}return t},e.prototype.getAllSpriteSheets=function(){var t={};return this.layers.forEach(function(e){e.getAllSpriteSheets().forEach(function(e){t[e.id]=e})}),this.tileMap&&this.tileMap.spriteSheet&&(t[this.tileMap.spriteSheet.id]=this.tileMap.spriteSheet),Object.keys(t).map(function(e){return t[e]})},e.prototype.getDefaultLayer=function(){return this.layers[0]},e.prototype.findObject=function(t){for(var e=0,r=this.layers;e<r.length;e++){var n=r[e].findObject(t);if(null!==n)return n}return null},e.prototype.addLayer=function(t){this.layers.push(t)},e.prototype.removeLayer=function(t){this.layers.remove(t)},e.prototype.appendChild=function(t){t.revalidate(),this.getDefaultLayer().appendChild(t)},e.prototype.prependChild=function(t){this.getDefaultLayer().prependChild(t)},e.prototype.findLayer=function(t){for(var e=0,r=this.layers;e<r.length;e++){var n=r[e];if(c.isObjectMatch(n,t))return n}return null},e.prototype.onPreloading=function(){},e.prototype.onProgress=function(t){},e.prototype.onReady=function(){},e.prototype.beforeUpdate=function(){},e.prototype.onUpdate=function(){},e.prototype.beforeRender=function(){},e.prototype.onRender=function(){},e.prototype.onDestroy=function(){},e.prototype.update=function(e,r){t.prototype.update.call(this,e,r),this.beforeUpdate();for(var n=0,i=this.layers;n<i.length;n++){i[n].update(e,r)}this.uiLayer.update(e,r),this.onUpdate()},e.prototype.renderMainFrame=function(){var t=this.game.getRenderer();this.game.camera.update(this.game.getTime(),this.game.getDeltaTime());for(var e=0,r=this.layers;e<r.length;e++){r[e].render()}this.tileMap.render(),t.save(),t.resetTransform(),this.game.camera.matrixMode=h.CAMERA_MATRIX_MODE.MODE_IDENTITY,this.uiLayer.render(),t.restore(),this.game.camera.matrixMode=h.CAMERA_MATRIX_MODE.MODE_TRANSFORM,this.onRender(),this.game.getRenderer().restore(),this.game.getRenderer().debugTextField&&(this.game.getRenderer().debugTextField.update(this.game.getTime(),this.game.getDeltaTime()),this.game.getRenderer().debugTextField.render()),this.game.getRenderer().restore()},e.prototype.renderPreloadingFrame=function(){this.game.getRenderer().resetTransform(),this.preloadingGameObject.render()},e.prototype.render=function(){this.beforeRender();var t=this.game.getRenderer();this.useBG?t.clearColor(this.colorBG):t.clear(),t.beginFrameBuffer(),this.useBG?t.clearColor(this.colorBG):t.clear(),this.game.camera.matrixMode=h.CAMERA_MATRIX_MODE.MODE_TRANSFORM,this.resourceLoader.isCompleted()?this.renderMainFrame():void 0!==this.preloadingGameObject&&this.renderPreloadingFrame(),t.flipFrameBuffer(this.filters)},e}(i.BaseModel);e.Scene=f},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){this.lastTime=0,this.interval=e,this.callback=t}return t.prototype.onUpdate=function(t){this.lastTime||(this.lastTime=t);var e=t-this.lastTime;0!==e&&e>this.interval&&(this.lastTime=t,this.callback())},t}();e.Timer=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){}return t.linear=function(t,e,r,n){return r*t/n+e},t.easeInQuad=function(t,e,r,n){return r*(t/=n)*t+e},t.easeOutQuad=function(t,e,r,n){return-r*(t/=n)*(t-2)+e},t.easeInOutQuad=function(t,e,r,n){return(t/=n/2)<1?r/2*t*t+e:-r/2*(--t*(t-2)-1)+e},t.easeInCubic=function(t,e,r,n){return r*(t/=n)*t*t+e},t.easeOutCubic=function(t,e,r,n){return t/=n,r*(--t*t*t+1)+e},t.easeInOutCubic=function(t,e,r,n){return(t/=n/2)<1?r/2*t*t*t+e:r/2*((t-=2)*t*t+2)+e},t.easeInQuart=function(t,e,r,n){return r*(t/=n)*t*t*t+e},t.easeOutQuart=function(t,e,r,n){return t/=n,-r*(--t*t*t*t-1)+e},t.easeInOutQuart=function(t,e,r,n){return(t/=n/2)<1?r/2*t*t*t*t+e:-r/2*((t-=2)*t*t*t-2)+e},t.easeInQuint=function(t,e,r,n){return r*(t/=n)*t*t*t*t+e},t.easeOutQuint=function(t,e,r,n){return t/=n,r*(--t*t*t*t*t+1)+e},t.easeInOutQuint=function(t,e,r,n){return(t/=n/2)<1?r/2*t*t*t*t*t+e:r/2*((t-=2)*t*t*t*t+2)+e},t.easeInSine=function(t,e,r,n){return-r*Math.cos(t/n*(Math.PI/2))+r+e},t.easeOutSine=function(t,e,r,n){return r*Math.sin(t/n*(Math.PI/2))+e},t.easeInOutSine=function(t,e,r,n){return-r/2*(Math.cos(Math.PI*t/n)-1)+e},t.easeInExpo=function(t,e,r,n){return r*Math.pow(2,10*(t/n-1))+e},t.easeOutExpo=function(t,e,r,n){return r*(1-Math.pow(2,-10*t/n))+e},t.easeInOutExpo=function(t,e,r,n){return(t/=n/2)<1?r/2*Math.pow(2,10*(t-1))+e:(t--,r/2*(2-Math.pow(2,-10*t))+e)},t.easeInCirc=function(t,e,r,n){return t/=n,-r*(Math.sqrt(1-t*t)-1)+e},t.easeOutCirc=function(t,e,r,n){return t/=n,t--,r*Math.sqrt(1-t*t)+e},t.easeInOutCirc=function(t,e,r,n){return(t/=n/2)<1?-r/2*(Math.sqrt(1-t*t)-1)+e:(t-=2,r/2*(Math.sqrt(1-t*t)+1)+e)},t.easeInElastic=function(t,e,r,n){var i=1.70158,o=0,s=r;return 0===t?e:1==(t/=n)?e+r:(o||(o=.3*n),s<Math.abs(r)?(s=r,i=o/4):i=o/(2*Math.PI)*Math.asin(r/s),-s*Math.pow(2,10*(t-=1))*Math.sin((t*n-i)*(2*Math.PI)/o)+e)},t.easeOutElastic=function(t,e,r,n){var i=1.70158,o=0,s=r;return 0===t?e:1==(t/=n)?e+r:(o||(o=.3*n),s<Math.abs(r)?(s=r,i=o/4):i=o/(2*Math.PI)*Math.asin(r/s),s*Math.pow(2,-10*t)*Math.sin((t*n-i)*(2*Math.PI)/o)+r+e)},t.easeInOutElastic=function(t,e,r,n){var i=1.70158,o=0,s=r;return 0===t?e:2==(t/=n/2)?e+r:(o||(o=n*(.3*1.5)),s<Math.abs(r)?(s=r,i=o/4):i=o/(2*Math.PI)*Math.asin(r/s),t<1?s*Math.pow(2,10*(t-=1))*Math.sin((t*n-i)*(2*Math.PI)/o)*-.5+e:s*Math.pow(2,-10*(t-=1))*Math.sin((t*n-i)*(2*Math.PI)/o)*.5+r+e)},t.easeInBack=function(t,e,r,n){var i=1.70158;return r*(t/=n)*t*((i+1)*t-i)+e},t.easeOutBack=function(t,e,r,n){var i=1.70158;return r*((t=t/n-1)*t*((i+1)*t+i)+1)+e},t.easeInOutBack=function(t,e,r,n){var i=1.70158;return(t/=n/2)<1?r/2*(t*t*((1+(i*=1.525))*t-i))+e:r/2*((t-=2)*t*((1+(i*=1.525))*t+i)+2)+e},t.easeInBounce=function(e,r,n,i){return n-t.easeOutBounce(i-e,0,n,i)+r},t.easeOutBounce=function(t,e,r,n){return(t/=n)<1/2.75?r*(7.5625*t*t)+e:t<2/2.75?r*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?r*(7.5625*(t-=2.25/2.75)*t+.9375)+e:r*(7.5625*(t-=2.625/2.75)*t+.984375)+e},t.easeInOutBounce=function(e,r,n,i){return e<i/2?.5*t.easeInBounce(2*e,0,n,i)+r:.5*t.easeOutBounce(2*e-i,0,n,i)+.5*n+r},t}();e.Easing=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(13),i=function(){function t(t){this.game=t,this._tweensInMovie=[],this._startedTime=null,this._completed=!1,this._loop=!1,this._onComplete=null}return t.prototype.tween=function(t,e){var r=new n.Tween(e);return this._tweensInMovie.push({startTime:t,tween:r}),this},t.prototype.loop=function(t){return this._loop=t,this},t.prototype.finish=function(t){return this._onComplete=t,this},t.prototype.play=function(){this.game.getCurrScene().addTweenMovie(this)},t.prototype.update=function(t){if(!this._completed){this._startedTime||(this._startedTime=t);var e=t-this._startedTime,r=!0;this._tweensInMovie.forEach(function(n){e>n.startTime&&(e<n.startTime+n.tween.getTweenTime()?n.tween.update(t):n.tween.complete()),n.tween.isCompleted()||(r=!1)}),r&&(this._loop?this.reset():(this._completed=!0,this._onComplete&&this._onComplete()))}},t.prototype.isCompleted=function(){return this._completed},t.prototype.reset=function(){return this._startedTime=null,this._completed=!1,this._tweensInMovie.forEach(function(t){t.tween.reset()}),this},t}();e.TweenMovie=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(0),i=r(2),o=r(29),s=r(18),a=r(1),u=function(t){function e(e){var r=t.call(this)||this;return r.game=e,r.type="TileMap",r.spriteSheet=null,r.data=[],r.width=0,r.height=0,r.blendMode="",r}return n.__extends(e,t),e.prototype.fromTiledJSON=function(t,e,r){this.data=[];for(var n=0,i=0;i<r;i++){this.data[i]=[];for(var s=0;s<e;s++){var u=t[n++];if(0===u)this.data[i][s]=void 0;else{this.data[i][s]={},this.data[i][s].val=u-1;var h=this.spriteSheet._frameWidth,c=this.spriteSheet._frameHeight,l=s*h,f=i*c,d=new o.Vec2(l+h/2,f+c/2),p=new o.RigidRectangle(this.game,d,h,c,0);p.fixedAngle=!0,this.data[i][s].rect=p}}}this.width=e,this.height=r;var g=n,m=t.length;if(m!==g)throw new a.DebugError("incorrect mapWidth/mapHeight provided. Expected "+m+" tiles, but "+g+" found ("+e+"*"+r+")")},e.prototype.revalidate=function(){this.game.camera._updateRect();var t=this.game.camera.getRectScaled();this.spriteSheet&&(this._tilesInScreenX=~~(t.width/this.spriteSheet._frameWidth),this._tilesInScreenY=~~(t.height/this.spriteSheet._frameHeight))},e.prototype.getTileAt=function(t,e){if(this.spriteSheet){var r=~~(t/this.spriteSheet._frameWidth),n=~~(e/this.spriteSheet._frameHeight);if(this.data[n]){var i=this.data[n][r];if(i)return{tileIndex:this.spriteSheet.numOfFramesH*n+r+1,tile:i}}}},e.prototype.getTilesAtRect=function(t){var e=[];if(!this.spriteSheet)return e;for(var r,n={},i=t.x,o=t.x+t.width,s=t.y+t.height;;){for(r=t.y;;){var a=this.getTileAt(i,r);if(a&&(n[a.tileIndex]||(e.push(a.tile),n[a.tileIndex]=!0)),r===s)break;(r+=this.spriteSheet._frameHeight)>s&&(r=s)}if(i===o)break;(i+=this.spriteSheet._frameWidth)>o&&(i=o)}return e},e.prototype.render=function(){var t=this.spriteSheet;if(t){var e=this.game.camera,r=(this.game.getRenderer(),e.getRectScaled()),n=~~(r.x/this.spriteSheet._frameWidth),o=~~(r.y/this.spriteSheet._frameHeight);n<0&&(n=0),o<0&&(o=0);for(var s=n+this._tilesInScreenX+1,a=o+this._tilesInScreenY+1,u=o;u<=a;u++)for(var h=n;h<=s;h++){var c=this.data[u]&&this.data[u][h]&&this.data[u][h].val;if(!1!==c&&null!==c&&void 0!==c)i.Rect.fromPool().clone().setXYWH(h*t._frameWidth,u*t._frameHeight,t._frameWidth,t._frameHeight)}}},e}(s.CommonObject);e.TileMap=u},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(0),i=function(t){function e(e){var r=t.call(this,e)||this;return r.type="Layer",r.children=[],r}return n.__extends(e,t),e.prototype.findObject=function(t){for(var e=0,r=this.children;e<r.length;e++){var n=r[e].findObject(t);if(null!==n)return n}return null},e.prototype.prependChild=function(t){t.parent=this,this.children.unshift(t),t.onShow()},e.prototype.appendChild=function(t){this.children.push(t),t.onShow()},e.prototype.getAllSpriteSheets=function(){var t=[];return this.children.forEach(function(e){e.spriteSheet&&!t.find(function(t){return e.id===t.id})&&t.push(e.spriteSheet)}),t},e.prototype.onShow=function(){this.children.forEach(function(t){t.onShow()})},e.prototype.update=function(t,e){for(var r=0,n=this.children;r<n.length;r++){n[r].update(t,e)}},e.prototype.render=function(){for(var t=0,e=this.children;t<e.length;t++){e[t].render()}},e}(r(20).BaseModel);e.Layer=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(0),i=function(t){function e(e){var r=t.call(this,e)||this;return r.direction=[1,1,1],r}return n.__extends(e,t),e.prototype.setUniforms=function(t){t["u_ambientLight.color"]=this.color.asGL(),t["u_ambientLight.direction"]=this.direction},e}(r(30).AbstractLight);e.AmbientLight=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(53),i=r(54),o=function(){function t(t){this.game=t,this.q=new n.Queue}return t.prototype.loadImage=function(t){var e=this,r=i.ResourceLink.create();return this.q.addTask(function(){e.game.getRenderer().loadTextureInfo(t,r,function(){return e.q.resolveTask(t)})},t),r},t.prototype.startLoading=function(){this.q.start()},t.prototype.isCompleted=function(){return this.q.isCompleted()},t.prototype.getProgress=function(){return this.q.calcProgress()},t.prototype.onProgress=function(t){this.q.onProgress=t},t.prototype.onCompleted=function(t){this.q.onResolved=t},t}();e.ResourceLoader=o},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){this.tasksResolved=0,this.tasks=[],this.tasksProgressById={},this.completed=!1}return t.prototype.size=function(){return this.tasks.length},t.prototype.progressTask=function(t,e){this.tasksProgressById[t]=e,this.onProgress&&this.onProgress(this.calcProgress())},t.prototype.resolveTask=function(t){this.tasksResolved++,this.tasksProgressById[t]=1,this.tasks.length===this.tasksResolved?(this.onProgress&&this.onProgress(1),this.completed=!0,this.onResolved&&this.onResolved()):this.onProgress&&this.onProgress(this.calcProgress())},t.prototype.addTask=function(t,e){void 0===this.tasksProgressById[e]&&(this.tasks.push(t),this.tasksProgressById[e]=0)},t.prototype.isCompleted=function(){return this.completed},t.prototype.calcProgress=function(){var t=this,e=0;return Object.keys(this.tasksProgressById).forEach(function(r){e+=t.tasksProgressById[r]||0}),e/this.tasks.length},t.prototype.start=function(){0===this.size()&&this.onResolved&&this.onResolved(),this.tasks.forEach(function(t){t&&t()})},t}();e.Queue=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=0,i=function(){function t(t){this.id=t}return t.prototype.getId=function(){return this.id},t.prototype.setTarget=function(t){this.target=t},t.prototype.getTarget=function(){return this.target},t.create=function(){return new t((n++).toString())},t}();e.ResourceLink=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(0);r(56);var i=r(57),o=r(22),s=r(27),a=r(58),u=r(18),h=r(31),c=r(32),l=r(4),f=r(59),d=r(61),p=r(69),g=r(1),m=r(36),_=function(t){function e(){var e=t.call(this)||this;return e._lastTime=0,e._currTime=0,e._deltaTime=0,e._running=!1,e._destroyed=!1,e.scale=new l.Point2d(1,1),e.pos=new l.Point2d(0,0),e.width=320,e.height=240,e.gravityConstant=0,e.fps=0,e.scaleStrategy=c.SCALE_STRATEGY.FIT,e._cnt=0,e.mouse=new o.Mouse(e),e.keyboard=new s.Keyboard(e),e.keyboard.listenTo(),e.gamePad=new a.GamePad(e),e.collider=new p.ColliderEngine(e),e.camera=new h.Camera(e),e.lightArray=new f.LightArray(e),e.uiBuilder=new d.UIBuilder(e),e.audioPlayer=new m.AudioPlayer(e),e.camera.revalidate(),window.game=e,e}return n.__extends(e,t),e.prototype.getTime=function(){return this._lastTime},e.prototype.getDeltaTime=function(){return this._deltaTime},e.prototype.log=function(t){this._renderer.log(t)},e.prototype.setRenderer=function(t){this._renderer=new t(this)},e.prototype.getRenderer=function(){return this._renderer},e.prototype.debug2=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(this._cnt++,console.log.apply(console,t),this._cnt>10)throw new g.DebugError("too many logs")},e.prototype.runScene=function(t){var e=this;this.revalidate(),t.onPreloading(),t.resourceLoader.onProgress(function(){t.onProgress(t.resourceLoader.getProgress())}),t.resourceLoader.startLoading(),this._currentScene=t,this._running||this.update(),this._running=!0,t.resourceLoader.onCompleted(function(){e._currentScene.onReady()})},e.prototype.getCurrScene=function(){return this._currentScene},e.prototype.update=function(){if(!this._destroyed){this._lastTime=this._currTime,this._currTime=Date.now();var t=this._currTime;this._lastTime||(this._lastTime=this._currTime),this._deltaTime=this._currTime-this._lastTime,this.fps=~~(1e3/this._deltaTime);var r=this._renderer.getError();if(r)throw new g.DebugError("render error with code "+r);var n=Math.min(this._deltaTime,e.UPDATE_TIME_RATE),i=~~(this._deltaTime/e.UPDATE_TIME_RATE)||1,o=this._currTime-i*e.UPDATE_TIME_RATE,s=0;do{if(this._currentScene.update(o,n),this.keyboard.update(),this.gamePad.update(),this.audioPlayer.update(o,n),o+=e.UPDATE_TIME_RATE,++s>10){this._lastTime=this._currTime=t;break}}while(s<i);this._currentScene.render(),requestAnimationFrame(this.update.bind(this))}},e.prototype.destroy=function(){var t=this;this._destroyed=!0;for(var e=setTimeout(function(){},0),r=setInterval(function(){},0),n=Math.max(e,r)+16,o=0;o<n;o++)clearInterval(o),clearTimeout(o);this.keyboard.destroy(),this.mouse.destroy(),this._renderer.cancelFullScreen(),i.BaseAbstractBehaviour.destroyAll(),setTimeout(function(){t._renderer.destroy()},200)},e.prototype.revalidate=function(){if(t.prototype.revalidate.call(this),!this._renderer)throw new g.DebugError("game renderer is not set")},e.UPDATE_TIME_RATE=20,e}(u.CommonObject);e.Game=_},function(t,e){Array.prototype.remove=function(t){for(var e=this.length,r=0;e--;)t(this[e],e)&&(this.splice(e,1),r++);return r},window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||function(t){setTimeout(t,17)},window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){return clearTimeout(t)}),Array.prototype.find||(Array.prototype.find=function(t){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var e,r=Object(this),n=r.length>>>0,i=arguments[1],o=0;o<n;o++)if(e=r[o],t.call(i,e,o,r))return e})},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(1),i=function(){function t(e){this.game=e,t.instances.push(this)}return t.prototype.manage=function(t,e){throw console.error(this),new n.DebugError("BaseAbstractBehaviour: method 'manage' not implemented")},t.prototype.onUpdate=function(t,e){},t.prototype.destroy=function(){},t.destroyAll=function(){t.instances.forEach(function(t){t.destroy()})},t.instances=[],t}();e.BaseAbstractBehaviour=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(27);window.addEventListener("gamepadconnected",function(t){console.log("Gamepad connected at index %d: %s. %d buttons, %d axes.",t.gamepad.index,t.gamepad.id,t.gamepad.buttons.length,t.gamepad.axes.length)}),window.addEventListener("gamepaddisconnected",function(t){console.log("Gamepad disconnected from index %d: %s",t.gamepad.index,t.gamepad.id)});var i=function(){function t(t){this.game=t}return t.prototype.update=function(){this.gamepads=navigator.getGamepads&&navigator.getGamepads()||navigator.webkitGetGamepads&&navigator.webkitGetGamepads()||navigator.webkitGamepads||navigator.mozGamepads||navigator.msGamepads||navigator.gamepads||[];for(var t=0,e=this.gamepads.length;t<e;t++){var r=this.gamepads[t];if(r){var i=r.buttons.length;i>7&&(i=7);for(var o=0;o<i;o++){r.buttons[o].pressed?this.game.keyboard.press(o):this.game.keyboard.release(o)}if(0!==r.axes[0]&&0!==r.axes[1]){var s=~~r.axes[0],a=~~r.axes[1];1===s?this.game.keyboard.press(n.KEY.GAME_PAD_AXIS_RIGHT):this.game.keyboard.release(n.KEY.GAME_PAD_AXIS_RIGHT),-1===s?this.game.keyboard.press(n.KEY.GAME_PAD_AXIS_LEFT):this.game.keyboard.release(n.KEY.GAME_PAD_AXIS_LEFT),1===a?this.game.keyboard.press(n.KEY.GAME_PAD_AXIS_DOWN):this.game.keyboard.release(n.KEY.GAME_PAD_AXIS_DOWN),-1===a?this.game.keyboard.press(n.KEY.GAME_PAD_AXIS_UP):this.game.keyboard.release(n.KEY.GAME_PAD_AXIS_UP)}}}},t}();e.GamePad=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(1),i=r(60),o=function(){function t(e){if(!e)throw new n.DebugError("game instance is not passed to LightArray constructor");this.lights=new Array(t.NUM_OF_LIGHT_IN_VIEW);for(var r=0;r<this.lights.length;r++)this.lights[r]=new i.PointLight(e)}return t.prototype.getLightAt=function(t){return this.lights[t]},t.prototype.setUniforms=function(t){for(var e=0;e<this.lights.length;e++){this.lights[e].setUniforms(t,e)}},t.NUM_OF_LIGHT_IN_VIEW=4,t}();e.LightArray=o},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(0),i=r(4),o=function(t){function e(e){var r=t.call(this,e)||this;return r.pos=new i.Point2d,r.nearRadius=0,r.farRadius=0,r.isOn=!1,r._screenPoint=new i.Point2d,r}return n.__extends(e,t),e.prototype.getPosScaled=function(){var t=this.game.camera,e=t.getRectScaled(),r=t.scale;return this._screenPoint.setXY((this.pos.x-e.x)*r.x,(this.pos.y-e.y)*r.y),this._screenPoint},e.prototype.setUniforms=function(t,e){t["u_pointLights["+e+"].pos"]=this.getPosScaled().toArray(),t["u_pointLights["+e+"].nearRadius"]=this.nearRadius,t["u_pointLights["+e+"].farRadius"]=this.farRadius,t["u_pointLights["+e+"].isOn"]=this.isOn,t["u_pointLights["+e+"].color"]=this.color.asGL()},e}(r(30).AbstractLight);e.PointLight=o},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(33),i=r(1),o=r(15),s=function(){function t(t){var e=this;this._components={},this.game=t,Object.keys(n).forEach(function(t){e.registerComponent(t,n[t])})}return t.prototype.registerComponent=function(t,e){this._components[t]=e},t._normalizeSetterName=function(t){return"set"+t[0].toUpperCase()+t.substr(1)},t._getFirstKey=function(t){if(o.isObject(t))return Object.keys(t)[0]},t._getAllKeys=function(t){return Object.keys(t)},t._getKeysLength=function(e){return t._getAllKeys(e).length},t.prototype._resolveProperties=function(e,r,n){var o=this;t._getAllKeys(r).forEach(function(s){if("children"!==s)if(o._components[s]){var a=o._components[s],u=void 0;u=n?new a(o.game):e,o._resolveProperties(u,r[s],n),n&&e.appendChild(u)}else{var h=t._normalizeSetterName(s),c=h in e;if(!(s in e)&&!c){var l=e.constructor&&e.constructor.name||e.type||"";throw new i.DebugError("uiBuilder error: object "+l+" has not property "+s+" not associated setter "+h)}if(o._components[t._getFirstKey(r[s])]){var f=new(0,o._components[t._getFirstKey(r[s])])(o.game);o._resolveProperties(f,r[s],!1),r[s]=f}if(c){(d=r[s]).splice||(d=[r[s]]),e[h].apply(e,d)}else{if(r[s].type){if(!(a=o._components[r[s].type]))throw new i.DebugError("unknown type: "+r[s].type);e[s]=new a(o.game)}if(e[s]&&e[s].fromJSON)e[s].fromJSON(r[s]);else if(e[s]&&e[s].apply){var d;(d=r[s]).splice||(d=[d]),e[s].apply(e,d)}else e[s]=r[s]}}else{if(!r.children.splice)throw new i.DebugError("'children' property must be an array");r.children.forEach(function(r){var n=t._getFirstKey(r),i=new(0,o._components[n])(o.game);o._resolveProperties(i,r[n],!0),e.appendChild(i)})}}),e.revalidate()},t.prototype.build=function(e){if(t._getKeysLength(e)>1)throw new i.DebugError("only one root element is supported. Found: "+t._getAllKeys(e));var r=t._getFirstKey(e),n=this._components[r];if(!n)throw new i.DebugError("no such ui class: "+r);var o=new n(this.game);return this._resolveProperties(o,e[r],!0),o.testLayout(),window.l=o,o},t}();e.UIBuilder=s},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(0),i=r(22),o=r(6),s=r(34),a=r(10),u=function(){function t(t){this.game=t,this._scrollVelocity=0,this._deceleration=0,this._enabled=!1,this.offset=0,this.scrollHeight=0}return t.prototype._initScrollBar=function(){this.vScroll=new s.VScroll(this.game),this.vScroll.width=5,this._container.appendChild(this.vScroll)},t.prototype.setEnabled=function(t){this._enabled=t,this.vScroll.enabled=t},t.prototype.onScroll=function(){this.vScroll.maxValue=this.scrollHeight,this.vScroll.value=this.offset,this.vScroll.onGeometryChanged()},t.prototype.listenScroll=function(t){var e=this;this._container=t,t.on(i.MOUSE_EVENTS.mouseDown,function(t){e._lastPoint={point:t,time:Date.now()},e._prevPoint={point:e._lastPoint.point,time:e._lastPoint.time},e._scrollVelocity=0,e._deceleration=0}),t.on(i.MOUSE_EVENTS.mouseMove,function(t){if(t.isMouseDown){var r=e._lastPoint;e._lastPoint={point:t,time:Date.now()},r||(r=e._lastPoint),e._prevPoint={point:r.point,time:r.time},e.offset-=e._lastPoint.point.screenY-e._prevPoint.point.screenY,e.offset>e.scrollHeight-e._container.height&&(e.offset=e.scrollHeight-e._container.height),e.offset<0&&(e.offset=0),e.onScroll()}}),t.on(i.MOUSE_EVENTS.scroll,function(t){e._scrollVelocity=-t.nativeEvent.wheelDelta,e._deceleration=0}),t.on(i.MOUSE_EVENTS.mouseUp,function(t){e._lastPoint&&e._prevPoint&&(e._lastPoint.time===e._prevPoint.time?e._scrollVelocity=0:Date.now()-e._lastPoint.time>100?e._scrollVelocity=0:e._scrollVelocity=1e3*(e._prevPoint.point.screenY-e._lastPoint.point.screenY)/(e._lastPoint.time-e._prevPoint.time),e._deceleration=0)}),this._initScrollBar()},t.prototype._scrollBy=function(t){this.offset+=t,this.offset>this.scrollHeight-this._container.height&&(this.offset=this.scrollHeight-this._container.height,this._scrollVelocity=0,this._deceleration=0),this.offset<0&&(this.offset=0,this._scrollVelocity=0,this._deceleration=0),this.onScroll()},t.prototype.update=function(t,e){this._enabled&&(this._scrollVelocity&&this.onScroll(),this._scrollVelocity&&this._scrollBy(this._scrollVelocity*e/1e3),this._deceleration=this._deceleration+.5/e,e>1e3&&(this._scrollVelocity=0,this._deceleration=0),this._scrollVelocity>0?this._scrollVelocity-=this._deceleration:this._scrollVelocity<0&&(this._scrollVelocity+=this._deceleration),a.MathEx.closeTo(this._scrollVelocity,0,3)&&(this._scrollVelocity=0,this._deceleration=0))},t}();e.ScrollInfo=u;var h=function(t){function e(e){return t.call(this,e)||this}return n.__extends(e,t),e.prototype._initScrolling=function(t){t.vertical&&(this.vScrollInfo=new u(this.game),this.vScrollInfo.listenScroll(this))},e.prototype.updateScrollSize=function(t,e){0!==e&&t>e?(this.vScrollInfo.scrollHeight=t,this.vScrollInfo.setEnabled(!0)):this.vScrollInfo.setEnabled(!1),this.vScrollInfo.vScroll.height=e,this.vScrollInfo.vScroll.pos.x=this.width-this.vScrollInfo.vScroll.width-2,this.vScrollInfo.onScroll()},e.prototype.update=function(e,r){this.vScrollInfo&&this.vScrollInfo.update(e,r),t.prototype.update.call(this,e,r)},e}(o.Container);e.ScrollableContainer=h},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(0),i=r(6),o=r(12),s=r(3),a=function(t){function e(e){var r=t.call(this,e)||this;r.checked=!1;var n=new o.Rectangle(e);n.width=10,n.height=10,n.fillColor=new s.Color(10,10,10,100);var i=new o.Rectangle(e);return i.width=10,i.height=10,i.fillColor=new s.Color(10,50,10,100),r.rNormal=n,r.rChecked=i,r.on("click",function(){return r.toggle()}),r}return n.__extends(e,t),e.prototype.toggle=function(){this.checked=!this.checked},e.prototype.onGeometryChanged=function(){this.rNormal.setWH(this.width,this.height),this.rChecked.setWH(this.width,this.height)},e.prototype.getBgByState=function(){return this.checked?this.rChecked:this.rNormal},e.prototype.draw=function(){var t=this.getBgByState();return t&&t.draw(),!0},e}(i.Container);e.CheckBox=a},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(0),i=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._radius=10,e}return n.__extends(e,t),Object.defineProperty(e.prototype,"radius",{get:function(){return this._radius},set:function(t){this._radius=t,this.width=this.height=2*t},enumerable:!0,configurable:!0}),e.prototype.draw=function(){return this.radiusX=this.radiusY=this.radius,this.game.getRenderer().drawEllipse(this),!0},e}(r(35).Ellipse);e.Circle=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(0),i=r(12),o=r(3),s=function(t){function e(e){var r=t.call(this,e)||this;return r.fillColor=o.Color.NONE,r}return n.__extends(e,t),e}(i.Rectangle);e.Border=s},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(0),i=r(17),o=r(1),s=function(t){function e(e){var r=t.call(this,e)||this;r.a=0,r.b=0,r.c=0,r.d=0,r._patches=[];for(var n=0;n<9;n++)r._patches[n]=new i.Image(r.game);return r.getRect().observe(function(){r.revalidate()}),r}return n.__extends(e,t),e.prototype._revalidatePatches=function(){this.game.getRenderer().renderableCache[this.getResourceLink().getId()];throw new o.DebugError("can not find texture info by id "+this.getResourceLink().getId())},e.prototype.revalidate=function(){if(!this.getResourceLink())throw new o.DebugError("can not render Image: resource link is not specified");var t=this.width,e=this.height;t<this.a+this.b&&(t=this.a+this.b),e<this.c+this.d&&(e=this.c+this.d),this.setWH(t,e),this._revalidatePatches()},e.prototype.setABCD=function(t,e,r,n){void 0===e&&(e=t),void 0===r&&(r=e),void 0===n&&(n=r),this.a=t,this.b=e,this.c=r,this.d=n,this.revalidate()},e.prototype.draw=function(){for(var t=0;t<9;t++)this._patches[t].render(!0);return!0},e}(i.Image);e.NinePatchImage=s},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(0),i=r(2),o=r(6),s=function(t){function e(e){return t.call(this,e)||this}return n.__extends(e,t),e.prototype.appendChild=function(e){e instanceof o.Container&&e.testLayout(),t.prototype.appendChild.call(this,e)},e.prototype.onGeometryChanged=function(){t.prototype.onGeometryChanged.call(this);for(var e=0,r=0,n=0,i=this.children;n<i.length;n++){var s=i[n];s instanceof o.Container&&s.onGeometryChanged(),s._dirty=!0;var a=s.getRect();a.right>e&&(e=a.right),a.bottom>r&&(r=a.bottom)}this.layoutWidth===o.LAYOUT_SIZE.WRAP_CONTENT&&(this.width=e),this.layoutHeight===o.LAYOUT_SIZE.WRAP_CONTENT&&(this.height=r),this.calcDrawableRect(this.width,this.height)},e.prototype.draw=function(){var t=this.game.getRenderer();if(this.overflow===o.OVERFLOW.HIDDEN){var e=i.Rect.fromPool().set(this.getScreenRect());e.addXY(-1,-1),e.setWH(e.width+1,e.height+1),t.lockRect(e)}return this.background&&this.background.draw(),t.translate(this.paddingLeft,this.paddingTop),this.overflow===o.OVERFLOW.HIDDEN&&this.game.getRenderer().unlockRect(),!0},e}(o.Container);e.AbsoluteLayout=s},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(3),i=r(1),o=function(){function t(){this.type="LinearGradient",this.colorFrom=new n.Color(0,0,0),this.colorTo=new n.Color(200,200,200),this.angle=.1,this._arr=new Array(12)}return t.prototype.fromJSON=function(t){if(!t.colorFrom)throw new i.DebugError("can not parse LinearGradient from JSON: colorFrom not defined");if(!t.colorTo)throw new i.DebugError("can not parse LinearGradient from JSON: colorTo not defined");this.colorFrom.fromJSON(t.colorFrom),this.colorTo.fromJSON(t.colorTo)},t.prototype.asGL=function(){var t=this.colorFrom.asGL(),e=this.colorTo.asGL();return this._arr[0]=t[0],this._arr[1]=t[1],this._arr[2]=t[2],this._arr[3]=t[3],this._arr[4]=e[0],this._arr[5]=e[1],this._arr[6]=e[2],this._arr[7]=e[3],this._arr[8]=this.angle,this._arr[9]=0,this._arr[10]=0,this._arr[11]=0,this._arr},t}();e.LinearGradient=o},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(29),i=r(2),o=r(10),s=function(){function t(t){this.relaxationCount=15,this.posCorrectionRate=.8,this.game=t}return t.prototype.positionalCorrection=function(t,e,r){var n=t.mInvMass,i=e.mInvMass,o=r.getDepth()/(n+i)*this.posCorrectionRate,s=r.getNormal().scale(o);t.move(s.scale(-n)),e.move(s.scale(i))},t.prototype.resolveCollision=function(t,e,r){if(0!==t.mInvMass||0!==e.mInvMass){this.positionalCorrection(t,e,r);var i=r.getNormal(),o=r.mStart.scale(e.mInvMass/(t.mInvMass+e.mInvMass)),s=r.mEnd.scale(t.mInvMass/(t.mInvMass+e.mInvMass)),a=o.add(s),u=a.subtract(t.mCenter),h=a.subtract(e.mCenter),c=t.mVelocity.add(new n.Vec2(-1*t.mAngularVelocity*u.y,t.mAngularVelocity*u.x)),l=e.mVelocity.add(new n.Vec2(-1*e.mAngularVelocity*h.y,e.mAngularVelocity*h.x)).subtract(c),f=l.dot(i);if(!(f>0)){var d=Math.min(t.mRestitution,e.mRestitution),p=Math.min(t.mFriction,e.mFriction),g=u.cross(i),m=h.cross(i),_=-(1+d)*f;_/=t.mInvMass+e.mInvMass+g*g*t.mInertia+m*m*e.mInertia;var y=i.scale(_);t.mVelocity=t.mVelocity.subtract(y.scale(t.mInvMass)),e.mVelocity=e.mVelocity.add(y.scale(e.mInvMass)),t.fixedAngle||(t.mAngularVelocity-=g*_*t.mInertia),e.fixedAngle||(e.mAngularVelocity+=m*_*e.mInertia);var v=l.subtract(i.scale(l.dot(i)));v=v.normalize().scale(-1);var E=u.cross(v),w=h.cross(v),x=-(1+d)*l.dot(v)*p;(x/=t.mInvMass+e.mInvMass+E*E*t.mInertia+w*w*e.mInertia)>_&&(x=_),y=v.scale(x),t.mVelocity=t.mVelocity.subtract(y.scale(t.mInvMass)),e.mVelocity=e.mVelocity.add(y.scale(e.mInvMass)),t.fixedAngle||(t.mAngularVelocity-=E*x*t.mInertia),e.fixedAngle||(e.mAngularVelocity+=w*x*e.mInertia)}}},t.prototype.boundAndCollide=function(t,e,r){t.boundTest(e)&&t.collisionTest(e,r)&&(r.getNormal().dot(e.mCenter.subtract(t.mCenter))<0&&r.changeDir(),this.resolveCollision(t,e,r))},t.prototype.collision=function(){var t,e,r,o=this,s=this.game.getCurrScene().getAllGameObjects().map(function(t){return t.rigidBody}),a=new n.CollisionInfo;for(r=0;r<this.relaxationCount;r++)for(t=0;t<s.length;t++)if(s[t]){var u=this.game.getCurrScene().tileMap.getTilesAtRect(new i.Rect(s[t].mCenter.x-s[t].mWidth/2,s[t].mCenter.y-s[t].mHeight/2,s[t].mWidth,s[t].mHeight));for(u.length&&u.forEach(function(e){o.boundAndCollide(s[t],e.rect,a)}),e=t+1;e<s.length;e++)s[e]&&this.boundAndCollide(s[t],s[e],a)}},t.prototype.isIntersect=function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=[]),t.filter(function(t){return-1!==e.indexOf(t)}).length>0},t.prototype.boundAndCollideAcrade=function(t,e){if(!t.velocity.equal(0)||!e.velocity.equal(0)){var r=0,n=o.MathEx.overlapTest(t.getRect(),e.getRect());if(n){if(!t.rigid||!e.rigid)return t.trigger("overlap",e),void e.trigger("overlap",t);for(;n&&!(r>3);){t.pos.x+=.01*-t.velocity.x,t.pos.y+=.01*-t.velocity.y,e.pos.x+=.01*-e.velocity.x,e.pos.y+=.01*-e.velocity.y,n=o.MathEx.overlapTest(t.getRect(),e.getRect()),r++}t.trigger("collide",e),e.trigger("collide",t)}}},t.prototype.collisionArcade=function(){for(var t=this.game.getCurrScene().getAllGameObjects(),e=0;e<t.length;e++)for(var r=e+1;r<t.length;r++){var n=t[e],i=t[r];(this.isIntersect(n.collideWith,i.groupNames)||this.isIntersect(i.collideWith,n.groupNames))&&this.boundAndCollideAcrade(n,i)}},t}();e.ColliderEngine=s},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(1),i=r(71),o=r(36),s=function(){function t(){}return t.fixAutoPlayPolicy=function(){var e=function(){t.res.resume(),document.removeEventListener("click",e)};document.addEventListener("click",e)},t.getCtx=function(){return t.ctx&&!t.res&&(t.res=new t.ctx,t.fixAutoPlayPolicy()),t.res},t.ctx=window.AudioContext,t.res=null,t}(),a=function(){function t(t){this.game=t,this.type="webAudioContext",this._ctx=null,this._currSource=null,this._gainNode=null,this._free=!0,this._ctx=s.getCtx(),this._gainNode=this._ctx.createGain(),this._gainNode.connect(this._ctx.destination)}return t.isAcceptable=function(){return!(!window||!s.getCtx())},t.prototype.load=function(t,e,r){o.AudioPlayer.cache[t]?r():i.LoaderUtil.loadBinary(t,e,function(e){!function(t,e){s.getCtx().decodeAudioData(t,function(t){e(t)},function(t){throw new n.DebugError(t.message)})}(e,function(e){o.AudioPlayer.cache[t]=e,r()})})},t.prototype.isFree=function(){return this._free},t.prototype.play=function(t,e){var r=this;this._free=!1;var n=this._ctx.createBufferSource();n.buffer=o.AudioPlayer.cache[t],n.loop=e,n.connect(this._gainNode),n.start(0),n.onended=function(){r.stop()},this._currSource=n},t.prototype.stop=function(){var t=this._currSource;t&&(t.stop(),t.disconnect(this._gainNode)),this._currSource=null,this._free=!0},t.prototype.setGain=function(t){this._gainNode.gain.value=t},t.prototype.pause=function(){this._ctx.suspend()},t.prototype.resume=function(){this._ctx.resume()},t}();e.WebAudioContext=a},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){}return t.loadBinary=function(t,e,r){var n=new XMLHttpRequest;n.open("GET",t,!0),n.responseType="arraybuffer",n.setRequestHeader("Accept-Ranges","bytes"),n.setRequestHeader("Content-Range","bytes"),n.onload=function(){r(n.response)},n.onprogress=function(r){e&&e(t,r.loaded/r.total)},n.onerror=function(e){throw console.error(e),"can not load resource with url "+t},n.send()},t}();e.LoaderUtil=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){}return t.getCtx=function(){return new(window&&window.Audio)},t}(),i=function(){function t(t){this.game=t,this.type="htmlAudioContext",this.free=!0,this._ctx=n.getCtx()}return t.isAcceptable=function(){return!(!window||!window.Audio)},t.prototype.load=function(t,e,r){r()},t.prototype.isFree=function(){return this.free},t.prototype.play=function(t,e){var r,n=this;r=t,this.free=!1,this._ctx.src=r,this._ctx.play(),this._ctx.loop=e,this._ctx.onended=function(){n.stop()}},t.prototype.stop=function(){this.free=!0},t.prototype.setGain=function(t){this._ctx.volume=t},t.prototype.pause=function(){this._ctx.pause()},t.prototype.resume=function(){throw"not implemented for now"},t}();e.HtmlAudioContext=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){this.game=t,this.type="fakeAudioContext",console.log("audio not supported")}return t.isAcceptable=function(){return!0},t.prototype.play=function(t,e){},t.prototype.stop=function(){},t.prototype.isFree=function(){return!1},t.prototype.setGain=function(t){},t.prototype.pause=function(){},t.prototype.resume=function(){},t.prototype.load=function(t,e,r){r()},t}();e.FakeAudioContext=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(75),i=function(){function t(t,e,r){this.ContextClass=e,this.numOfNodes=r,this.nodes=[];for(var i=0;i<r;i++)this.nodes.push(new n.AudioNode(new e(t)))}return t.prototype.getFreeNode=function(){for(var t=0;t<this.numOfNodes;t++)if(this.nodes[t].isFree())return this.nodes[t];return null},t.prototype.stopAll=function(){for(var t=0;t<this.numOfNodes;t++)this.nodes[t].stop()},t.prototype.pauseAll=function(){for(var t=0;t<this.numOfNodes;t++)this.nodes[t].pause()},t.prototype.resumeAll=function(){for(var t=0;t<this.numOfNodes;t++)this.nodes[t].resume()},t.prototype.getNodeBySound=function(t){for(var e=0;e<this.numOfNodes;e++)if(this.nodes[e].getCurrSound()==t)return this.nodes[e];return null},t}();e.AudioNodeSet=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){this.context=t,this.currSound=null}return t.prototype.play=function(t,e){void 0===e&&(e=!1),this.context.play(t,e)},t.prototype.stop=function(){this.context.stop(),this.currSound=null},t.prototype.setGain=function(t){this.context.setGain(t)},t.prototype.pause=function(){this.context.pause()},t.prototype.resume=function(){this.context.resume()},t.prototype.isFree=function(){return this.context.isFree()},t.prototype.getCurrSound=function(){return this.currSound},t}();e.AudioNode=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(0),i=r(1),o=r(11),s=r(77),a=r(82),u=r(40),h=r(83),c=r(9),l=r(41),f=r(84),d=r(2),p=r(88),g=r(14),m=r(91),_=r(39),y=new h.MatrixStack,v=function(t,e){var r=c.makeZToWMatrix(1),n=c.ortho(0,e.width,0,e.height,-1e3,1e3),i=c.makeScale(t.width,t.height,1),o=c.makeTranslation(t.x,t.y,0),s=c.matrixMultiply(i,o);return s=c.matrixMultiply(s,y.getCurrentMatrix()),s=c.matrixMultiply(s,n),s=c.matrixMultiply(s,r)},E=function(t){function e(e){var r=t.call(this,e)||this;return r.matrixStack=y,r.registerResize(),r._init(),r}return n.__extends(e,t),e.prototype._init=function(){var t=function(t){return t.getContext("webgl",{alpha:!1})||t.getContext("experimental-webgl",{alpha:!1})||t.getContext("webkit-3d",{alpha:!1})||t.getContext("moz-webgl",{alpha:!1})}(this.container);this.gl=t,this.nullTexture=new l.Texture(t),this.shapeDrawer=new a.ShapeDrawer(t),this.lineDrawer=new s.LineDrawer(t),this.modelDrawer=new m.ModelDrawer(t),this.addBlendDrawer=new f.AddBlendDrawer(t),this.frameBuffer=new u.FrameBuffer(t,this.game.width,this.game.height),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.enable(t.BLEND),this._initFlipTexture(),this.currShapeUniformInfo={}},e.prototype._initFlipTexture=function(){var t=this.fullScreenSize;this.flipTextureInfo=[{texture:null,name:"texture"}];var e=0,r=0,n=t.width,i=t.height,o=Math.max(n,i),s=this.flipUniformInfo={},a=this.shapeDrawer;o==n?(s[a.u_width]=1,s[a.u_height]=i/n,r=(o-i)/2,s[a.u_rectOffsetLeft]=0,s[a.u_rectOffsetTop]=r/o):(s[a.u_height]=1,s[a.u_width]=n/i,e=(o-n)/2,s[a.u_rectOffsetLeft]=e/o,s[a.u_rectOffsetTop]=0),this.translate(0,this.game.height),this.scale(1,-1),s[a.u_vertexMatrix]=v(d.Rect.fromPool().setXYWH(-e,-r,o,o),g.Size.fromPool().setWH(this.game.width,this.game.height)),s[a.u_lineWidth]=0,s[a.u_borderRadius]=0,s[a.u_shapeType]=_.SHAPE_TYPE.RECT,s[a.u_fillType]=_.FILL_TYPE.TEXTURE,s[a.u_texRect]=[0,0,1,1],s[a.u_texOffset]=[0,0],s[a.u_alpha]=1},e.prototype.prepareShapeUniformInfo=function(t){var e=this.currShapeUniformInfo,r=t.getRect().width,n=t.getRect().height,i=Math.max(r,n),o=0,s=0,a=this.shapeDrawer;return i==r?(e[a.u_width]=1,e[a.u_height]=n/r,s=(i-n)/2,e[a.u_rectOffsetLeft]=0,e[a.u_rectOffsetTop]=s/i):(e[a.u_height]=1,e[a.u_width]=r/n,o=(i-r)/2,e[a.u_rectOffsetLeft]=o/i,e[a.u_rectOffsetTop]=0),e[a.u_vertexMatrix]=v(d.Rect.fromPool().setXYWH(-o,-s,i,i),g.Size.fromPool().setWH(this.game.width,this.game.height)),e[a.u_lineWidth]=Math.min(t.lineWidth/i,1),e[a.u_color]=t.color.asGL(),e[a.u_alpha]=t.alpha,"LinearGradient"==t.fillColor.type?(e[a.u_fillLinearGradient]=t.fillColor.asGL(),e[a.u_fillType]=_.FILL_TYPE.LINEAR_GRADIENT):"Color"==t.fillColor.type&&(e[a.u_fillColor]=t.fillColor.asGL(),e[a.u_fillType]=_.FILL_TYPE.COLOR),e},e.prototype.drawImage=function(t){if(!t.getResourceLink())throw new i.DebugError("image resource link is not set");if(!this.renderableCache[t.getResourceLink().getId()])throw new i.DebugError("can not find texture with resource link id "+t.getResourceLink().getId());var e=this.renderableCache[t.getResourceLink().getId()].texture,r=[{texture:e=e.applyFilters(t.filters,this.frameBuffer),name:"texture"}],n=Math.max(t.width,t.height),o=this.shapeDrawer,s=this.prepareShapeUniformInfo(t);s[o.u_borderRadius]=Math.min(t.borderRadius/n,1),s[o.u_shapeType]=_.SHAPE_TYPE.RECT,s[o.u_fillType]=_.FILL_TYPE.TEXTURE,s[o.u_texRect]=[t.srcRect.x/e.getSize().width,t.srcRect.y/e.getSize().height,t.srcRect.width/e.getSize().width,t.srcRect.height/e.getSize().height],s[o.u_texOffset]=[t.offset.x/n,t.offset.y/n],this.shapeDrawer.draw(r,s,null)},e.prototype.drawModel=function(t){this.modelDrawer.bindModel(t),this.modelDrawer.bind(),y.scale(1,-1,1);var e=y.getCurrentMatrix(),r=c.makeZToWMatrix(1),n=c.ortho(0,this.game.width,0,this.game.height,-1e3,1e3),i={u_modelMatrix:e,u_projectionMatrix:c.matrixMultiply(n,r),u_alpha:1},o=[{texture:t.texture,name:"u_texture"}];this.gl.enable(this.gl.DEPTH_TEST),this.modelDrawer.draw(o,i),this.modelDrawer.unbind(),this.gl.disable(this.gl.DEPTH_TEST)},e.prototype.drawRectangle=function(t){var e=t.width,r=t.height,n=Math.max(e,r),i=this.shapeDrawer,o=this.prepareShapeUniformInfo(t);o[i.u_borderRadius]=Math.min(t.borderRadius/n,1),o[i.u_shapeType]=_.SHAPE_TYPE.RECT;var s=[{texture:this.nullTexture,name:"texture"}];this.shapeDrawer.draw(s,o,null)},e.prototype.drawLine=function(t,e,r,n,i){var o=r-t,s=n-e,a={};a.u_vertexMatrix=v(d.Rect.fromPool().setXYWH(t,e,o,s),g.Size.fromPool().setWH(this.game.width,this.game.height)),a.u_rgba=i.asGL(),this.lineDrawer.draw(null,a,null)},e.prototype.drawEllipse=function(t){var e=Math.max(t.radiusX,t.radiusY),r=2*e,n=this.prepareShapeUniformInfo(t),i=this.shapeDrawer;n[i.u_vertexMatrix]=v(d.Rect.fromPool().setXYWH(t.pos.x,t.pos.y,r,r),g.Size.fromPool().setWH(this.game.width,this.game.height)),n[i.u_lineWidth]=Math.min(t.lineWidth/e,1),e==t.radiusX?(n[i.u_rx]=.5,n[i.u_ry]=t.radiusY/t.radiusX*.5):(n[i.u_ry]=.5,n[i.u_rx]=t.radiusX/t.radiusY*.5),n[i.u_shapeType]=_.SHAPE_TYPE.ELLIPSE,n[i.u_width]=1,n[i.u_height]=1,n[i.u_rectOffsetLeft]=1,n[i.u_rectOffsetTop]=1;var o=[{texture:this.nullTexture,name:"texture"}];this.shapeDrawer.draw(o,n,null)},e.prototype.setAlpha=function(t){throw new i.DebugError("not implemented")},e.prototype.save=function(){this.matrixStack.save()},e.prototype.scale=function(t,e){this.matrixStack.scale(t,e)},e.prototype.resetTransform=function(){this.matrixStack.resetTransform()},e.prototype.rotateZ=function(t){this.matrixStack.rotateZ(t)},e.prototype.rotateY=function(t){this.matrixStack.rotateY(t)},e.prototype.translate=function(t,e){this.matrixStack.translate(t,e)},e.prototype.restore=function(){this.matrixStack.restore()},e.prototype.lockRect=function(t){this.gl.enable(this.gl.SCISSOR_TEST),this.gl.scissor(t.x,t.y,t.width,t.height)},e.prototype.unlockRect=function(){this.gl.disable(this.gl.SCISSOR_TEST)},e.prototype.clear=function(){this.gl.clearColor(1,1,1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)},e.prototype.clearColor=function(t){var e=t.asGL();this.gl.clearColor(e[0],e[1],e[2],e[3]),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)},e.prototype.beginFrameBuffer=function(){this.save(),this.frameBuffer.bind()},e.prototype.flipFrameBuffer=function(t){var e=this.frameBuffer.getTexture().applyFilters(t,null);this.frameBuffer.unbind(),this.gl.viewport(0,0,this.fullScreenSize.width,this.fullScreenSize.height),this.flipTextureInfo[0].texture=e,this.shapeDrawer.draw(this.flipTextureInfo,this.flipUniformInfo,null),this.restore()},e.prototype.getError=function(){var t=this.gl.getError();return(t=t===this.gl.NO_ERROR?0:t)&&console.log(o.AbstractDrawer.currentInstance),t},e.prototype.loadTextureInfo=function(t,e,r){var n=this;if(this.renderableCache[e.getId()])r();else{var o=new window.Image;o.src=t,o.onload=function(){var t=new l.Texture(n.gl);t.setImage(o),n.gl.bindTexture(n.gl.TEXTURE_2D,n.frameBuffer.getTexture().getGlTexture());var i={texture:t,size:t.size,name:void 0};n.renderableCache[e.getId()]=i,e.setTarget(i),r()},o.onerror=function(){throw new i.DebugError('Resource loading error: can not load resource with url "'+t+'"')}}},e.prototype.destroy=function(){var e=this;t.prototype.destroy.call(this),this.frameBuffer.destroy(),o.AbstractDrawer.destroyAll(),Object.keys(this.renderableCache).forEach(function(t){e.renderableCache[t].texture.destroy()})},e}(p.AbstractCanvasRenderer);e.WebGlRenderer=E},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(0),i=r(78),o=r(7),s=r(16),a=r(11),u=r(81),h=function(t){function e(e){var r=t.call(this,e)||this,n=new u.ColorShaderGenerator;return r.program=new o.ShaderProgram(e,n.getVertexSource(),n.getFragmentSource()),r.primitive=new i.Line,r.bufferInfo=new s.BufferInfo(e,{posVertexInfo:{array:r.primitive.vertexArr,type:e.FLOAT,size:2,attrName:"a_position"},drawMethod:r.gl.LINE_STRIP}),r}return n.__extends(e,t),e}(a.AbstractDrawer);e.LineDrawer=h},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(0),i=function(t){function e(){var e=t.call(this)||this;return e.vertexArr=[0,0,1,1],e.indexArr=[0,1],e}return n.__extends(e,t),e}(r(37).AbstractPrimitive);e.Line=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(1),i=function(){function t(t){if(this.bufferItemSize=0,this.bufferItemType=0,this.dataLength=0,!t)throw new n.DebugError("can not create VertexBuffer, gl context not passed to constructor, expected: VertexBuffer(gl)");if(this.gl=t,this.buffer=t.createBuffer(),!this.buffer)throw new n.DebugError("can not allocate memory for vertex buffer")}return t.prototype.setData=function(t,e,r){if(!t)throw new n.DebugError("can not set data to buffer: bufferData not specified");if(!e)throw new n.DebugError("can not set data to buffer: itemType not specified");if(!r)throw new n.DebugError("can not set data to buffer: itemSize not specified");var i=this.gl;i.bindBuffer(i.ARRAY_BUFFER,this.buffer),i.bufferData(i.ARRAY_BUFFER,new Float32Array(t),i.STATIC_DRAW),i.bindBuffer(i.ARRAY_BUFFER,null),this.bufferItemSize=r,this.bufferItemType=e,this.dataLength=t.length},t.prototype.setAttrName=function(t){if(!t)throw new n.DebugError("attrName not provided");this.attrName=t},t.prototype.bind=function(t){if(!t)throw new n.DebugError("can not bind VertexBuffer, program not specified");if(!this.attrName)throw new n.DebugError("can not bind VertexBuffer, attribute name not specified");t.bindBuffer(this,this.attrName)},t.prototype.unbind=function(){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null)},t.prototype.destroy=function(){this.gl.deleteBuffer(this.buffer)},t.prototype.getGlBuffer=function(){return this.buffer},t.prototype.getItemSize=function(){return this.bufferItemSize},t.prototype.getItemType=function(){return this.bufferItemType},t.prototype.getBufferLength=function(){return this.dataLength},t}();e.VertexBuffer=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(1),i=function(){function t(t){if(!t)throw new n.DebugError("can not create IndexBuffer, gl context not passed to constructor, expected: IndexBuffer(gl)");if(this.gl=t,this.buffer=t.createBuffer(),!this.buffer)throw new n.DebugError("can not allocate memory for index buffer");this.dataLength=null}return t.prototype.setData=function(t){if(!t)throw new n.DebugError("can not set data to buffer: bufferData not specified");var e=this.gl;this.dataLength=t.length,e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.buffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array(t),e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)},t.prototype.getGlBuffer=function(){return this.buffer},t.prototype.bind=function(){this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.buffer)},t.prototype.unbind=function(){this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,null)},t.prototype.destroy=function(){this.gl.deleteBuffer(this.buffer)},t.prototype.getBufferLength=function(){return this.dataLength},t}();e.IndexBuffer=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(0),i=r(5),o=function(t){function e(){var e=t.call(this)||this;return e.addAttribute(i.GL_TYPE.FLOAT_VEC4,"a_position"),e.addVertexUniform(i.GL_TYPE.FLOAT_MAT4,"u_vertexMatrix"),e.setVertexMainFn("\n            void main(){\n                gl_Position = u_vertexMatrix * a_position;   \n            }\n        "),e.addFragmentUniform(i.GL_TYPE.FLOAT,"u_alpha"),e.addFragmentUniform(i.GL_TYPE.FLOAT_VEC4,"u_rgba"),e.setFragmentMainFn("\n            void main(){\n                gl_FragColor = u_rgba;\n            }\n        "),e}return n.__extends(e,t),e}(r(23).ShaderGenerator);e.ColorShaderGenerator=o},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(0),i=r(7),o=r(11),s=r(16),a=r(38),u=r(5),h=r(39),c=r(23),l=function(t){function e(e){var r=t.call(this,e)||this,n=new c.ShaderGenerator;return n.setVertexMainFn("\n            void main(){\n                v_position = a_position;\n                gl_Position = u_vertexMatrix * a_position;   \n            }\n        "),r.u_vertexMatrix=n.addVertexUniform(u.GL_TYPE.FLOAT_MAT4,"u_vertexMatrix"),r.a_position=n.addAttribute(u.GL_TYPE.FLOAT_VEC4,"a_position"),n.addVarying(u.GL_TYPE.FLOAT_VEC4,"v_position"),r.u_lineWidth=n.addFragmentUniform(u.GL_TYPE.FLOAT,"u_lineWidth"),r.u_rx=n.addFragmentUniform(u.GL_TYPE.FLOAT,"u_rx"),r.u_ry=n.addFragmentUniform(u.GL_TYPE.FLOAT,"u_ry"),r.u_width=n.addFragmentUniform(u.GL_TYPE.FLOAT,"u_width"),r.u_height=n.addFragmentUniform(u.GL_TYPE.FLOAT,"u_height"),r.u_rectOffsetTop=n.addFragmentUniform(u.GL_TYPE.FLOAT,"u_rectOffsetTop"),r.u_rectOffsetLeft=n.addFragmentUniform(u.GL_TYPE.FLOAT,"u_rectOffsetLeft"),r.u_borderRadius=n.addFragmentUniform(u.GL_TYPE.FLOAT,"u_borderRadius"),r.u_color=n.addFragmentUniform(u.GL_TYPE.FLOAT_VEC4,"u_color"),r.u_alpha=n.addFragmentUniform(u.GL_TYPE.FLOAT,"u_alpha"),r.u_fillColor=n.addFragmentUniform(u.GL_TYPE.FLOAT_VEC4,"u_fillColor"),r.u_fillLinearGradient=n.addFragmentUniform(u.GL_TYPE.FLOAT_VEC4,"u_fillLinearGradient[3]"),r.u_texRect=n.addFragmentUniform(u.GL_TYPE.FLOAT_VEC4,"u_texRect"),r.u_texOffset=n.addFragmentUniform(u.GL_TYPE.FLOAT_VEC2,"u_texOffset"),n.addFragmentUniform(u.GL_TYPE.SAMPLER_2D,"texture"),r.u_shapeType=n.addFragmentUniform(u.GL_TYPE.INT,"u_shapeType"),r.u_fillType=n.addFragmentUniform(u.GL_TYPE.INT,"u_fillType"),n.setFragmentMainFn(h.fragmentSource),r.program=new i.ShaderProgram(e,n.getVertexSource(),n.getFragmentSource()),r.primitive=new a.Plane,r.bufferInfo=new s.BufferInfo(e,{posVertexInfo:{array:r.primitive.vertexArr,type:e.FLOAT,size:2,attrName:r.a_position},posIndexInfo:{array:r.primitive.indexArr},drawMethod:r.gl.TRIANGLE_STRIP}),r}return n.__extends(e,t),e}(o.AbstractDrawer);e.ShapeDrawer=l},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(9),i=function(){function t(){this.stack=[],this.restore()}return t.prototype.restore=function(){this.stack.pop(),this.stack.length<1&&(this.stack[0]=n.makeIdentity())},t.prototype.save=function(){this.stack.push(this.getCurrentMatrix())},t.prototype.getCurrentMatrix=function(){return this.stack[this.stack.length-1].slice()},t.prototype.setCurrentMatrix=function(t){return this.stack[this.stack.length-1]=t},t.prototype.translate=function(t,e,r){void 0===r&&(r=0);var i=n.makeTranslation(t,e,r),o=this.getCurrentMatrix();return this.setCurrentMatrix(n.matrixMultiply(i,o)),this},t.prototype.rotateZ=function(t){var e=n.makeZRotation(t),r=this.getCurrentMatrix();return this.setCurrentMatrix(n.matrixMultiply(e,r)),this},t.prototype.rotateY=function(t){var e=n.makeYRotation(t),r=this.getCurrentMatrix();return this.setCurrentMatrix(n.matrixMultiply(e,r)),this},t.prototype.scale=function(t,e,r){void 0===r&&(r=1);var i=n.makeScale(t,e,r),o=this.getCurrentMatrix();return this.setCurrentMatrix(n.matrixMultiply(i,o)),this},t.prototype.resetTransform=function(){var t=n.makeIdentity();return this.setCurrentMatrix(t),this},t}();e.MatrixStack=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(0),i=function(t){function e(e){return t.call(this,e)||this}return n.__extends(e,t),e.prototype.prepare=function(t){t.setFragmentMainFn("\n            void main(){\n                vec4 srcColor =  texture2D(texture, v_texCoord)*2.0;\n                srcColor.a *= u_alpha;\n                vec4 destColor = texture2D(destTexture, v_destTexCoord.xy);\n                vec4 res = min(srcColor + destColor,vec4(1.0));\n                gl_FragColor = res;\n            }\n        ")},e}(r(85).AbstractBlendDrawer);e.AddBlendDrawer=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(42),i=r(5),o=r(24),s=r(7),a=r(86),u=function(){function t(t){this.gl=t;var e=new o.TexShaderGenerator;e.addVarying(i.GL_TYPE.FLOAT_VEC4,"v_destTexCoord"),e.addFragmentUniform(i.GL_TYPE.SAMPLER_2D,"destTexture"),e.setVertexMainFn("\n            void main(){\n                gl_Position = u_vertexMatrix * a_position;\n                v_texCoord = (u_textureMatrix * vec4(a_texCoord, 0, 1)).xy;\n                v_destTexCoord = gl_Position*0.5+0.5; \n            }\n        "),this.prepare(e),this._afterPrepare(e),this.simpleCopyFilter=new a.SimpleCopyFilter(t)}return t.prototype._afterPrepare=function(t){this.program=new s.ShaderProgram(this.gl,t.getVertexSource(),t.getFragmentSource()),this.spriteRectDrawer=new n.SpriteRectDrawer(this.gl,this.program)},t.prototype.prepare=function(t){},t.prototype.draw=function(t,e,r){var n=r.texture.applyFilters([this.simpleCopyFilter],r);t.push({texture:n,name:"destTexture"}),this.spriteRectDrawer.draw(t,e,r)},t}();e.AbstractBlendDrawer=u},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(0),i=r(87),o=r(5),s=function(t){function e(e){return t.call(this,e)||this}return n.__extends(e,t),e.prototype.prepare=function(t){t.addFragmentUniform(o.GL_TYPE.FLOAT,"u_mixFactor"),t.setFragmentMainFn("\n            void main(){\n                gl_FragColor = texture2D(texture, v_texCoord);\n            }\n        ")},e}(i.AbstractFilter);e.SimpleCopyFilter=s},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(7),i=r(42),o=r(9),s=r(24),a=r(1),u=o.makeIdentity(),h=function(){function t(t){if(this.spriteRectDrawer=null,this.uniformsToSet={},!t)throw console.error(this),new a.DebugError("can not create Filter, gl context not passed to constructor, expected: Filter(gl)");this.gl=t;var e=new s.TexShaderGenerator;this.prepare(e),this._afterPrepare(e)}return t.prototype.prepare=function(t){},t.prototype._afterPrepare=function(t){var e=new n.ShaderProgram(this.gl,t.getVertexSource(),t.getFragmentSource());this.spriteRectDrawer=new i.SpriteRectDrawer(this.gl,e)},t.prototype.doFilter=function(t,e){e&&e.bind();var r=t[0].texture.size.width,n=t[0].texture.size.height;this.uniformsToSet.u_textureMatrix=u,this.uniformsToSet.u_vertexMatrix=function(t,e,r,n){var i=o.ortho(0,r,0,n,-1,1),s=o.makeScale(r,n,1);return o.matrixMultiply(s,i)}(0,0,r,n),this.spriteRectDrawer.draw(t,this.uniformsToSet,null)},t.prototype.setParam=function(t,e){this.uniformsToSet[t]=e},t}();e.AbstractFilter=h},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(0),i=r(89),o=r(32),s=function(t){function e(e){var r=t.call(this,e)||this,n=document.createElement("canvas");return document.body.appendChild(n),n.setAttribute("width",e.width.toString()),n.setAttribute("height",e.height.toString()),n.ondragstart=function(t){t.preventDefault()},r.container=n,r}return n.__extends(e,t),e.prototype.draw=function(t){t.spriteSheet.width=t.width,t.spriteSheet.height=t.height,this.drawImage(t.spriteSheet)},e.prototype.onResize=function(){var t=this.container;if(this.game.scaleStrategy!==o.SCALE_STRATEGY.NO_SCALE){if(this.game.scaleStrategy===o.SCALE_STRATEGY.STRETCH)return t.style.width=window.innerWidth+"px",void(t.style.height=window.innerHeight+"px");var e,r,n=t.height/t.width;window.innerHeight/window.innerWidth<n?e=(r=window.innerHeight)/n:r=(e=window.innerWidth)*n,this.game.scale.setXY(e/this.game.width,r/this.game.height),this.game.pos.setXY((window.innerWidth-e)/2,(window.innerHeight-r)/2),this.container.style.width=e+"px",this.container.style.height=r+"px",this.container.style.marginTop=this.game.pos.y+"px"}},e}(i.AbstractRenderer);e.AbstractCanvasRenderer=s},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(19),i=r(90),o=r(14),s=r(1),a=function(){function t(t){if(this.renderableCache={},this.fullScreenSize=new o.Size(0,0),this.game=t,i.Device.isCocoonJS){var e=window.devicePixelRatio||1;this.fullScreenSize.setW(window.innerWidth*e),this.fullScreenSize.setH(window.innerHeight*e)}else this.fullScreenSize.setWH(this.game.width,this.game.height)}return t.prototype.onResize=function(){},t.prototype.requestFullScreen=function(){var t=this.container;t.requestFullScreen?t.requestFullScreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullScreen&&t.webkitRequestFullScreen()},t.prototype.cancelFullScreen=function(){document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen()},t.prototype.beginFrameBuffer=function(){},t.prototype.flipFrameBuffer=function(t){},t.prototype.registerResize=function(){var t=this;this.onResize(),window.addEventListener("resize",function(){return t.onResize()})},t.prototype.destroy=function(){window.removeEventListener("resize",this.onResize)},t.prototype.getError=function(){return 0},t.prototype.drawImage=function(t){},t.prototype.drawNinePatch=function(t){},t.prototype.drawTiledImage=function(t,e,r,n){},t.prototype.drawRectangle=function(t){},t.prototype.lockRect=function(t){},t.prototype.unlockRect=function(){},t.prototype.drawLine=function(t,e,r,n,i){},t.prototype.drawModel=function(t){},t.prototype.drawEllipse=function(t){},t.prototype.resetTransform=function(){},t.prototype.clear=function(){},t.prototype.clearColor=function(t){},t.prototype.save=function(){},t.prototype.restore=function(){},t.prototype.translate=function(t,e,r){},t.prototype.scale=function(t,e,r){},t.prototype.rotateZ=function(t){},t.prototype.rotateY=function(t){},t.prototype.draw=function(t){},t.prototype.log=function(t){var e=this.debugTextField;e||((e=new n.TextField(this.game)).name="defaultName",e.revalidate(),this.debugTextField=e);var r="";Array.prototype.slice.call(arguments).forEach(function(t){if(void 0===t)t="undefined";else if(null===t)t="null";else if(t.toJSON)t=JSON.stringify(t.toJSON(),null,4);else if("string"!=typeof t)try{t=JSON.stringify(t)}catch(t){}"string"!=typeof t&&(t=t.toString()),r+=t+"\n"}),e.pos.x=10,e.pos.y=10,e.setText(e.getText()+r)},t.prototype.loadTextureInfo=function(t,e,r){},t.prototype.getTextureInfo=function(t){var e=this.renderableCache[t];if(!e)throw new s.DebugError("can not find resource with id "+t);return e},t}();e.AbstractRenderer=a},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){this.game=t}return t.logInfo=function(){console.log({isCocoonJS:t.isCocoonJS,scale:t.scale,isTouch:t.isTouch})},t.isCocoonJS=!!navigator.isCocoonJS,t.scale=t.isCocoonJS&&window.devicePixelRatio||1,t.isTouch="undefined"!=typeof window&&"ontouchstart"in window,t}();e.Device=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(0),i=r(7),o=r(11),s=r(16),a=r(1),u="\n\nattribute vec4 a_position;\nattribute vec2 a_texcoord;\nattribute vec3 a_normal;\n\nuniform mat4 u_modelMatrix;\nuniform mat4 u_projectionMatrix;\n\nvarying vec2 v_texcoord;\nvarying vec3 v_normal;\n\nvoid main() {\n\n  gl_Position = u_projectionMatrix * u_modelMatrix * a_position;\n  v_texcoord = a_texcoord;\n  v_normal = a_normal;\n}\n",h="\n\nprecision highp float;\n\nvarying vec2 v_texcoord;\nvarying vec3 v_normal;\n\nuniform sampler2D u_texture;\nuniform float u_alpha;\nuniform mat4 u_modelMatrix;\n\n\nvoid main() {\n\n    vec3 lightDirection = normalize(vec3(-1,-1,1));\n    vec3 normalized = normalize((u_modelMatrix * vec4(v_normal,0)).xyz);\n    float lightFactor = max(0.5,dot(lightDirection,normalized));\n    gl_FragColor = texture2D(u_texture, v_texcoord);\n    gl_FragColor.rgb *= lightFactor;\n    gl_FragColor.a *= u_alpha;\n}\n\n",c=function(t){function e(e){var r=t.call(this,e)||this;return r.program=new i.ShaderProgram(e,u,h),r}return n.__extends(e,t),e.prototype._initBufferInfo=function(){this.g3d.bufferInfo=new s.BufferInfo(this.gl,{posVertexInfo:{array:this.g3d.model.vertexArr,type:this.gl.FLOAT,size:3,attrName:"a_position"},posIndexInfo:{array:this.g3d.model.indexArr},texVertexInfo:{array:this.g3d.model.texCoordArr,type:this.gl.FLOAT,size:2,attrName:"a_texcoord"},normalInfo:{array:this.g3d.model.normalArr,type:this.gl.FLOAT,size:3,attrName:"a_normal"},drawMethod:this.gl.TRIANGLES})},e.prototype.bindModel=function(t){this.g3d=t,this.g3d.bufferInfo||this._initBufferInfo(),this.bufferInfo=this.g3d.bufferInfo},e.prototype.bind=function(){if(!this.g3d.model)throw new a.DebugError("can not bind modelDrawer;bindModel must be invoked firstly");t.prototype.bind.call(this)},e.prototype.unbind=function(){this.g3d=null,t.prototype.unbind.call(this)},e}(o.AbstractDrawer);e.ModelDrawer=c},,,,,,,,,,,function(t,e,r){t.exports=r(103)},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(104),i=r(55),o=r(76),s=new i.Game;s.setRenderer(o.WebGlRenderer);var a=new n.MainScene(s);s.runScene(a)},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(0),i=r(45),o=r(105),s=r(19),a=r(3),u=r(44),h=r(12),c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n.__extends(e,t),e.prototype.onPreloading=function(){var t=new o.Font(this.game);t.fontSize=50,t.fontFamily="monospace",t.fontColor=a.Color.RGB(200,0,12),t.createContext();var e=this.resourceLoader.loadImage(t.createBitmap());t.setResourceLink(e);var r=new s.TextField(this.game);r.setFont(t),r.setText("hello"),this.appendChild(r);var n=new u.Button(this.game);n.setFont(t),n.setText("click me!"),n.pos.setXY(20,90);var i=new h.Rectangle(this.game);i.borderRadius=15,i.fillColor=a.Color.RGB(0,120,1),n.background=i,n.setPaddings(15),n.on("click",function(){r.setText(Math.random().toString())}),this.appendChild(n)},e.prototype.onReady=function(){},e}(i.Scene);e.MainScene=c},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(0),i=r(2),o=r(43),s=r(3),a=function(){function t(){}return t.getFontHeight=function(t){var e=document.createElement("span");e.appendChild(document.createTextNode("height!ДдЙЇ")),document.body.appendChild(e),e.style.cssText="font: "+t+"; white-space: nowrap; display: inline;";var r=e.offsetHeight;return document.body.removeChild(e),r},t.getFontContext=function(e,r,n){var o=document.createElement("canvas"),s=o.getContext("2d");s.font=r;for(var a=t.getFontHeight(r)+2*t.SYMBOL_PADDING,u={},h=0,c=0,l=a,f=0;f<e.length;f++)for(var d=e[f],p=d.from;p<d.to;p++){var g=String.fromCharCode(p),m=(s=o.getContext("2d")).measureText(g).width;if(0!=(m+=2*t.SYMBOL_PADDING)){h+m>n&&(h=0,l=(c+=a)+a);var _=new i.Rect;_.x=~~h+t.SYMBOL_PADDING,_.y=~~c+t.SYMBOL_PADDING,_.width=~~m-2*t.SYMBOL_PADDING,_.height=a-2*t.SYMBOL_PADDING,u[g]=_,h+=m}}return{symbols:u,width:n,height:l}},t.getFontImageBase64=function(t,e,r){var n=document.createElement("canvas");n.width=t.width,n.height=t.height;var i=n.getContext("2d");i.font=e,i.fillStyle=r.asCSS(),i.textBaseline="top";var o=t.symbols;return Object.keys(o).forEach(function(t){var e=o[t];i.fillText(t,e.x,e.y)}),n.toDataURL()},t.SYMBOL_PADDING=4,t}(),u=function(t){function e(e){var r=t.call(this,e)||this;return r.type="Font",r.fontSize=12,r.fontFamily="Monospace",r.fontContext=null,r.fontColor=s.Color.BLACK.clone(),r}return n.__extends(e,t),e.prototype.asCss=function(){return this.fontSize+"px "+this.fontFamily},e.prototype.createContext=function(){this.fontContext=a.getFontContext([{from:32,to:150},{from:1040,to:1116}],this.asCss(),128)},e.prototype.createBitmap=function(){return a.getFontImageBase64(this.fontContext,this.asCss(),this.fontColor)},e.prototype.getDefaultSymbolHeight=function(){return this.fontContext.symbols[" "].height},e}(o.Resource);e.Font=u}]);